<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 Taf3el - Ultimate Social Media Services Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #3b82f6, #1d4ed8);
            --success-gradient: linear-gradient(135deg, #059669, #047857);
            --dark-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            --admin-gradient: linear-gradient(135deg, #dc2626, #991b1b);
            --referral-gradient: linear-gradient(135deg, #8b5cf6, #7c3aed);
            --profit-gradient: linear-gradient(135deg, #10b981, #059669);
        }
        
        body { 
            font-family: 'Cairo', 'Tajawal', sans-serif; 
            overflow-x: hidden;
            background: var(--dark-gradient);
        }
        
        .gradient-bg { background: var(--dark-gradient); }
        .card-hover { 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        .card-hover:hover { 
            transform: scale(1.05); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); 
        }
        
        /* Simple glow effects without animations */
        .glow { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
        .text-glow { text-shadow: 0 0 10px rgba(59, 130, 246, 0.8); }
        .service-card { 
            background: linear-gradient(145deg, #1e293b, #334155); 
            border: 1px solid #475569; 
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        .service-card:hover { 
            border-color: #3b82f6; 
            transform: scale(1.05);
        }
        .btn-primary { 
            background: var(--primary-gradient); 
            transition: transform 0.3s ease, background 0.3s ease;
            border-radius: 8px;
            font-weight: 600;
        }
        .btn-primary:hover { 
            background: linear-gradient(135deg, #1d4ed8, #1e40af); 
            transform: scale(1.05);
        }
        .btn-admin {
            background: var(--admin-gradient);
            transition: transform 0.3s ease, background 0.3s ease;
            border-radius: 8px;
            font-weight: 600;
        }
        .btn-admin:hover {
            background: linear-gradient(135deg, #991b1b, #7f1d1d);
            transform: scale(1.05);
        }
        .stats-card { 
            background: linear-gradient(145deg, #0f172a, #1e293b); 
            border: 1px solid #334155;
            transition: transform 0.3s ease;
        }
        .stats-card:hover {
            transform: scale(1.05);
        }
        .order-status-pending { color: #fbbf24; }
        .order-status-processing { color: #3b82f6; }
        .order-status-completed { color: #10b981; }
        .order-status-cancelled { color: #ef4444; }
        .balance-card { 
            background: var(--success-gradient); 
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(5, 150, 105, 0.3);
        }
        .notification { 
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        /* Admin panel styles */
        .admin-panel {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border: 2px solid #dc2626;
            border-radius: 16px;
            backdrop-filter: blur(20px);
        }
        
        .admin-star {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 20px rgba(251, 191, 36, 0.4);
        }
        
        .admin-star:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(251, 191, 36, 0.6);
        }
        
        /* Modal styles */
        .modal {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 16px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            max-width: 95%;
            width: 500px;
        }
        
        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .auto-save-indicator.show {
            opacity: 1;
        }
        
        /* User profile dropdown */
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 12px;
            min-width: 250px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }
        
        /* Language switch */
        .lang-switch {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .admin-star {
                width: 40px;
                height: 40px;
            }
            
            .container {
                padding: 0 16px;
            }
            
            .grid {
                gap: 16px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            
            .user-actions {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .service-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .admin-tabs-container {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 10px;
            }
            
            .admin-tab {
                font-size: 12px;
                padding: 8px 12px;
                white-space: nowrap;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .service-details-content {
                width: 95%;
                padding: 15px;
            }
            
            .auth-form, .signup-form-improved {
                padding: 20px;
            }
            
            .admin-card {
                padding: 15px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .admin-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .service-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Loading spinner - static */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 20px;
            height: 20px;
        }
        
        /* Form styles */
        .form-input {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px 16px;
            color: white;
            transition: border-color 0.3s ease, transform 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: scale(1.02);
        }
        
        .form-select {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px 16px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .form-select:hover {
            transform: scale(1.02);
        }
        
        /* Table styles */
        .data-table {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .data-table th {
            background: rgba(15, 23, 42, 0.8);
            padding: 16px;
            font-weight: 600;
            border-bottom: 1px solid #475569;
        }
        
        .data-table td {
            padding: 16px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .data-table tr:hover {
            background: rgba(51, 65, 85, 0.3);
        }
        
        /* Progress bar */
        .progress-bar {
            background: rgba(71, 85, 105, 0.3);
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        /* Badge styles */
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .badge-warning { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .badge-error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .badge-info { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
        
        /* Service details modal */
        .service-details-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .service-details-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .service-details-content {
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* Order card styles */
        .order-card {
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .order-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        /* Admin dashboard styles */
        .admin-dashboard {
            display: none;
        }
        
        .admin-dashboard.show {
            display: block;
        }
        
        .admin-card {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .admin-card:hover {
            border-color: #dc2626;
            transform: scale(1.02);
        }
        
        /* Enhanced animations */
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Enhanced button styles */
        .btn-details {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn-details:hover {
            background: linear-gradient(135deg, #047857, #065f46);
            transform: scale(1.05);
        }
        
        /* Enhanced service card layout */
        .service-card-enhanced {
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .service-card-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .service-card-enhanced:hover::before {
            transform: scaleX(1);
        }
        
        .service-card-enhanced:hover {
            border-color: #3b82f6;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }

        /* Auth form styles */
        .auth-form {
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 16px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .auth-input {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px 16px;
            color: white;
            width: 100%;
            transition: all 0.3s ease;
        }

        .auth-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .auth-input::placeholder {
            color: #94a3b8;
        }

        .auth-btn {
            background: var(--primary-gradient);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            width: 100%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
        }

        .auth-link {
            color: #3b82f6;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .auth-link:hover {
            color: #60a5fa;
        }
        
        /* Fixed admin dashboard display */
        .admin-dashboard {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .admin-dashboard.show {
            display: block;
            opacity: 1;
        }
        
        /* إضافة أنماط جديدة */
        .admin-action-btn {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 4px;
            white-space: nowrap;
        }
        .edit-btn {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }
        .delete-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }
        .admin-btn {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid #fbbf24;
        }
        .withdraw-btn {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid #8b5cf6;
        }
        .add-balance-btn {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }
        .reply-section {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
        }
        .profile-form {
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        .edit-indicator {
            position: absolute;
            top: 0;
            left: 0;
            background: #3b82f6;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 0 0 6px 0;
        }
        
        /* New styles for added features */
        .referral-card {
            background: var(--referral-gradient);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .referral-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        .analytics-chart {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            padding: 20px;
            height: 300px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
        }
        
        .chart-bar {
            width: 30px;
            background: linear-gradient(to top, #3b82f6, #1e40af);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: height 0.5s ease;
        }
        
        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            color: #94a3b8;
        }
        
        .two-factor-box {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .qr-code {
            background: white;
            padding: 10px;
            border-radius: 8px;
            display: inline-block;
            margin: 15px 0;
        }
        
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        /* رسالة تم الرد عليها */
        .message-replied {
            border-left: 4px solid #10b981;
        }
        
        /* New styles for contact page */
        .user-info-card {
            background: linear-gradient(145deg, #1e293b, #334155);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .message-thread {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .user-message {
            background: rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 10px;
            max-width: 80%;
            margin-left: auto;
        }
        
        .admin-reply {
            background: rgba(16, 185, 129, 0.2);
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 10px;
            max-width: 80%;
            margin-right: auto;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
            color: #94a3b8;
        }
        
        .new-thread-form {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }
        
        /* تحسينات جديدة */
        .signup-form-improved {
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 16px;
            padding: 32px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .referral-field {
            background: rgba(139, 92, 246, 0.1);
            border-left: 3px solid #8b5cf6;
        }
        
        .contact-form-improved {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        .welcome-banner {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        /* New styles for admin tabs */
        .admin-tabs-container {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .admin-tab {
            padding: 10px 16px;
            border-radius: 8px;
            background: rgba(71, 85, 105, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 14px;
        }
        
        .admin-tab:hover {
            background: rgba(71, 85, 105, 0.5);
        }
        
        .admin-tab.active {
            background: var(--primary-gradient);
            font-weight: 600;
        }
        
        /* New style for disabled button */
        .btn-disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Profit styles */
        .profit-card {
            background: var(--profit-gradient);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .profit-chart {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            padding: 20px;
            height: 300px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
        }
        
        .profit-bar {
            width: 30px;
            background: linear-gradient(to top, #10b981, #047857);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: height 0.5s ease;
        }
        
        .profit-bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            color: #94a3b8;
        }
        
        .profit-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        
        .profit-box {
            background: rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        
        .profit-value {
            font-size: 24px;
            font-weight: bold;
            color: #10b981;
        }
        
        .profit-label {
            font-size: 14px;
            color: #94a3b8;
        }
        
        /* ألوان جديدة لأزرار المسح */
        .clear-data-btn {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            width: 100%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .clear-data-btn:hover {
            background: linear-gradient(135deg, #991b1b, #7f1d1d);
            transform: translateY(-2px);
        }
        
        /* New styles for added features */
        .message-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .discount-banner {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            border-radius: 8px;
            padding: 8px 12px;
            text-align: center;
            margin-top: 10px;
            animation: pulse 2s infinite;
            font-size: 14px;
        }
        
        .discount-timer {
            font-weight: bold;
            font-size: 1rem;
            color: #fbbf24;
            margin-top: 3px;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #94a3b8;
            font-size: 0.9rem;
            margin-left: 5px;
        }
        
        .discount-percent {
            background: #ef4444;
            color: white;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.8rem;
            margin-left: 5px;
        }
        
        .tracking-btn {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid #8b5cf6;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 4px;
            white-space: nowrap;
        }
        
        .tracking-btn:hover {
            background: rgba(139, 92, 246, 0.4);
        }
        
        .chat-btn {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid #3b82f6;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 4px;
            white-space: nowrap;
        }
        
        .chat-btn:hover {
            background: rgba(59, 130, 246, 0.4);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        /* أزرار إدارة الرصيد الجديدة */
        .add-balance-btn {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 4px;
            white-space: nowrap;
        }
        
        .add-balance-btn:hover {
            background: rgba(16, 185, 129, 0.4);
        }
        
        .withdraw-btn {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid #8b5cf6;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 4px;
            white-space: nowrap;
        }
        
        .withdraw-btn:hover {
            background: rgba(139, 92, 246, 0.4);
        }
        
        /* زر مسح البيانات الجديد */
        .clear-all-data-btn {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            width: 100%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .clear-all-data-btn:hover {
            background: linear-gradient(135deg, #991b1b, #7f1d1d);
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="gradient-bg text-white min-h-screen">
    <!-- Auto-save indicator -->
    <div id="autoSaveIndicator" class="auto-save-indicator">
        <span id="autoSaveText">تم الحفظ تلقائياً</span>
    </div>
    
    <!-- Admin Star Button -->
    <div class="fixed top-4 right-4 z-50">
        <div class="admin-star" onclick="showAdminModal()">
            <span class="text-2xl">⭐</span>
        </div>
    </div>
    
    <!-- Header -->
    <header class="bg-slate-800/50 backdrop-blur-sm border-b border-slate-700 sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between header-content">
                <div class="flex items-center space-x-4 rtl:space-x-reverse">
                    <h1 class="text-2xl font-bold text-glow">🚀 Taf3el</h1>
                    <span class="text-sm text-slate-400">منصة تزويد خدمات السوشيال ميديا</span>
                </div>
                
                <nav class="hidden md:flex items-center space-x-6 rtl:space-x-reverse nav-links">
                    <button onclick="showPage('home')" class="nav-btn text-blue-400 border-b-2 border-blue-400 pb-1">الرئيسية</button>
                    <button onclick="scrollToServices()" class="nav-btn hover:text-blue-400 transition-colors pb-1">الخدمات</button>
                    <button onclick="showPage('orders')" class="nav-btn hover:text-blue-400 transition-colors pb-1">طلباتي</button>
                    <button onclick="showPage('contact')" class="nav-btn hover:text-blue-400 transition-colors pb-1 relative">
                        الدعم الفني
                        <span id="supportBadge" class="message-badge hidden">0</span>
                    </button>
                    <button id="adminNav" class="nav-btn hover:text-red-400 hidden transition-colors pb-1" onclick="showAdminDashboard()">
                        لوحة التحكم
                    </button>
                </nav>

                <div class="flex items-center space-x-4 rtl:space-x-reverse user-actions">
                    <div id="userProfile" class="hidden flex items-center space-x-4 rtl:space-x-reverse relative">
                        <div class="balance-card px-4 py-2 rounded-lg">
                            <span class="text-sm">الرصيد: </span>
                            <span class="font-bold" id="userBalance">0</span>
                        </div>
                        <button onclick="showBalanceModal()" class="btn-primary px-4 py-2 rounded-lg">شحن الرصيد</button>
                        
                        <div class="relative">
                            <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-600 transition-colors" id="userAvatar" onclick="toggleUserDropdown()">
                                <span class="text-sm font-bold" id="userInitial">U</span>
                            </div>
                            <div id="userDropdown" class="user-dropdown hidden">
                                <div class="p-4 border-b border-slate-600">
                                    <div class="font-semibold" id="userName">المستخدم</div>
                                    <div class="text-xs text-slate-400" id="userPhone"></div>
                                </div>
                                <div class="p-2">
                                    <button onclick="showProfile()" class="w-full text-right px-4 py-2 hover:bg-slate-600 rounded-lg transition-colors">
                                        الملف الشخصي
                                    </button>
                                    <hr class="my-2 border-slate-600">
                                    <button onclick="logout()" class="w-full text-right px-4 py-2 hover:bg-red-600 rounded-lg transition-colors text-red-400">
                                        تسجيل الخروج
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="authButtons" class="flex space-x-2 rtl:space-x-reverse">
                        <button onclick="showLoginModal()" class="btn-primary px-4 py-2 rounded-lg">
                            تسجيل الدخول
                        </button>
                        <button onclick="showSignupModal()" class="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg transition-colors">
                            إنشاء حساب
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div id="loginModal" class="modal fixed inset-0 z-50 hidden">
        <div class="auth-form">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold mb-2">تسجيل الدخول</h2>
                <p class="text-slate-400">مرحباً بعودتك إلى Taf3el</p>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">رقم الهاتف</label>
                    <input type="tel" id="loginPhone" class="auth-input" placeholder="أدخل رقم هاتفك" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">كلمة المرور</label>
                    <input type="password" id="loginPassword" class="auth-input" placeholder="أدخل كلمة المرور" required>
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="rememberMe" class="mr-2">
                    <label for="rememberMe" class="text-sm">تذكرني</label>
                </div>
                
                <button type="submit" class="auth-btn">تسجيل الدخول</button>
            </form>
            
            <div class="text-center mt-4">
                <p class="text-slate-400">ليس لديك حساب؟ 
                    <a href="#" onclick="hideLoginModal(); showSignupModal();" class="auth-link">إنشاء حساب جديد</a>
                </p>
                
            </div>
            
            <button onclick="hideLoginModal()" class="absolute top-4 left-4 text-slate-400 hover:text-white">
                ✕
            </button>
        </div>
    </div>

    <!-- Signup Modal - تم تحسينه -->
    <div id="signupModal" class="modal fixed inset-0 z-50 hidden">
        <div class="signup-form-improved">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold mb-2">إنشاء حساب جديد</h2>
                <p class="text-slate-400">انضم إلى Taf3el اليوم واحصل على مكافأة 5 جنيه!</p>
            </div>
            
            <form id="signupForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">الاسم الكامل</label>
                    <input type="text" id="signupName" class="auth-input" placeholder="أدخل اسمك الكامل" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">رقم الهاتف</label>
                    <input type="tel" id="signupPhone" class="auth-input" placeholder="أدخل رقم هاتفك" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">كلمة المرور</label>
                    <input type="password" id="signupPassword" class="auth-input" placeholder="أدخل كلمة مرور قوية" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">تأكيد كلمة المرور</label>
                    <input type="password" id="signupConfirmPassword" class="auth-input" placeholder="أعد إدخال كلمة المرور" required>
                </div>
                
                
                <button type="submit" class="auth-btn">إنشاء الحساب</button>
            </form>
            
            <div class="text-center mt-4">
                <p class="text-slate-400">لديك حساب بالفعل؟ 
                    <a href="#" onclick="hideSignupModal(); showLoginModal();" class="auth-link">تسجيل الدخول</a>
                </p>
            </div>
            
            <button onclick="hideSignupModal()" class="absolute top-4 left-4 text-slate-400 hover:text-white">
                ✕
            </button>
        </div>
    </div>

    <!-- Two-Factor Authentication Modal -->
    <div id="twoFactorModal" class="modal fixed inset-0 z-50 hidden">
        <div class="auth-form">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold mb-2">توثيق ثنائي العامل</h2>
                <p class="text-slate-400">لتعزيز أمان حسابك</p>
            </div>
            
            <div class="two-factor-box">
                <div class="mb-4">
                    <span class="security-badge">
                        <i class="fas fa-shield-alt"></i> الحماية القصوى
                    </span>
                </div>
                
                <p class="mb-4">قم بمسح رمز الاستجابة السريعة (QR Code) باستخدام تطبيق التوثيق:</p>
                
                <div class="qr-code">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=Taf3el-2FA-Example" alt="QR Code">
                </div>
                
                <p class="text-sm text-slate-400 mt-4">أو أدخل الرمز يدوياً: <span class="font-mono">TAF3EL-2FA-SECRET</span></p>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium mb-2">رمز التحقق المكون من 6 أرقام</label>
                    <input type="text" id="twoFactorCode" class="auth-input text-center tracking-widest" placeholder="123456" maxlength="6">
                </div>
                
                <div class="flex space-x-2 rtl:space-x-reverse mt-6">
                    <button onclick="verifyTwoFactor()" class="btn-primary flex-1 py-2">تفعيل</button>
                    <button onclick="hideTwoFactorModal()" class="bg-slate-700 hover:bg-slate-600 flex-1 py-2">إلغاء</button>
                </div>
            </div>
            
            <button onclick="hideTwoFactorModal()" class="absolute top-4 left-4 text-slate-400 hover:text-white">
                ✕
            </button>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal fixed inset-0 z-50 hidden">
        <div class="modal-content">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4 text-center">🔐 دخول المدير</h3>
                <form id="adminLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">كلمة مرور المدير</label>
                        <input type="password" id="adminPassword" class="form-input w-full" placeholder="أدخل كلمة مرور المدير" required>
                    </div>
                    <button type="submit" class="btn-admin w-full py-3">دخول</button>
                </form>
                <button onclick="hideAdminModal()" class="absolute top-4 left-4 text-slate-400 hover:text-white">
                    ✕
                </button>
            </div>
        </div>
    </div>

    <!-- Balance Modal -->
    <div id="balanceModal" class="modal fixed inset-0 z-50 hidden">
        <div class="modal-content">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4 text-center">💰 شحن الرصيد</h3>
                <form id="balanceForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">المبلغ (جنيه)</label>
                        <input type="number" id="chargeAmount" class="form-input w-full" placeholder="5" min="5" required step="0.01">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">طريقة الدفع</label>
                        <select id="paymentMethod" class="form-select w-full" required onchange="toggleVodafoneNumbers()">
                            <option value="">اختر طريقة الدفع</option>
                            <option value="vodafone_cash">فودافون كاش</option>
                        </select>
                    </div>
                    
                    <div id="vodafoneNumbers" class="hidden">
                        <label class="block text-sm font-medium mb-2">اختر رقم التحويل</label>
                        <div class="bg-slate-700/50 p-4 rounded-lg space-y-2">
                            <label class="flex items-center space-x-3 rtl:space-x-reverse cursor-pointer">
                                <input type="radio" name="transferNumber" value="01013062296" class="form-radio h-4 w-4 text-blue-600 bg-slate-800 border-slate-600 focus:ring-blue-500" required>
                                <span class="font-bold text-green-400">01013062296</span>
                            </label>
                            <label class="flex items-center space-x-3 rtl:space-x-reverse cursor-pointer">
                                <input type="radio" name="transferNumber" value="01554887765" class="form-radio h-4 w-4 text-blue-600 bg-slate-800 border-slate-600 focus:ring-blue-500">
                                <span class="font-bold text-green-400">01554887765</span>
                            </label>
                            <p class="text-sm text-slate-400 pt-2">قم بالتحويل على الرقم الذي اخترته ثم أدخل رقم هاتفك الذي حولت منه.</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">رقم الهاتف الذي تم التحويل منه</label>
                        <input type="text" id="transactionId" class="form-input w-full" placeholder="أدخل رقم الهاتف" required>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full py-3">إرسال طلب الشحن</button>
                </form>
                <button onclick="hideBalanceModal()" class="absolute top-4 left-4 text-slate-400 hover:text-white">
                    ✕
                </button>
            </div>
        </div>
    </div>

    <!-- Service Details Modal -->
    <div id="serviceDetailsModal" class="service-details-modal">
        <div class="service-details-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold" id="serviceTitle">تفاصيل الخدمة</h3>
                <button onclick="closeServiceModal()" class="text-slate-400 hover:text-white">✕</button>
            </div>
            
            <div id="serviceInfo" class="mb-6">
                <!-- Service details will be loaded here -->
            </div>
            
            <form id="serviceOrderForm" class="space-y-4" onsubmit="handleServiceOrder(event)">
                <div>
                    <label class="block text-sm font-medium mb-2">رابط المحتوى</label>
                    <input type="url" id="contentLink" class="form-input w-full" placeholder="https://www.tiktok.com/@username/video/..." required>
                </div>
                
                <div id="quantityField">
                    <label class="block text-sm font-medium mb-2">الكمية</label>
                    <input type="number" id="quantity" class="form-input w-full" min="1" value="1" oninput="calculateTotalPrice()">
                    <div id="quantityError" class="text-red-400 text-sm mt-1 hidden"></div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">ملاحظات (اختياري)</label>
                    <textarea id="orderNotes" class="form-input w-full" rows="3" placeholder="أي ملاحظات إضافية..."></textarea>
                </div>
                
                <div class="bg-slate-700/50 p-4 rounded-lg">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">إجمالي السعر:</span>
                        <span class="text-xl font-bold text-green-400" id="totalPrice">0 جنيه</span>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary w-full py-3">طلب الخدمة</button>
            </form>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 left-4 z-50 space-y-2">
        <!-- Notifications will appear here -->
    </div>

    <!-- Clear All Data Modal -->
    <div id="clearAllDataModal" class="modal fixed inset-0 z-50 hidden">
        <div class="modal-content">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4 text-center">⚠️ مسح جميع البيانات</h3>
                <p class="text-center text-slate-300 mb-4">هذا الإجراء سيمسح جميع الطلبات والرسائل والإحصائيات باستثناء بيانات العملاء. سيتم طلب كلمة مرور المدير للتأكيد.</p>
                
                <form id="clearDataForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">كلمة مرور المدير</label>
                        <input type="password" id="clearDataPassword" class="form-input w-full" placeholder="أدخل كلمة مرور المدير" required>
                    </div>
                    <button type="submit" class="btn-admin w-full py-3">تأكيد المسح</button>
                </form>
                <button onclick="hideClearAllDataModal()" class="absolute top-4 left-4 text-slate-400 hover:text-white">
                    ✕
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Home Page -->
        <div id="homePage" class="page-content">
            <!-- Hero Section -->
            <section class="text-center mb-12">
                <div class="welcome-banner">
                    <h2 class="text-4xl font-bold mb-4 text-white">مرحباً بك في Taf3el</h2>
                    <p class="text-xl text-slate-200 mb-8">أفضل منصة لتزويد خدمات السوشيال ميديا بأسعار منافسة وجودة عالية</p>
                    <div class="flex justify-center space-x-4 rtl:space-x-reverse">
                        <button onclick="scrollToServices()" class="bg-white text-blue-600 px-8 py-3 rounded-lg text-lg font-semibold glow">تصفح الخدمات</button>
                        <button onclick="showPage('orders')" class="bg-slate-800/70 text-white px-8 py-3 rounded-lg text-lg font-semibold transition-colors">طلباتي</button>
                    </div>
                </div>
            </section>

            <!-- TikTok Services Section -->
            <section id="servicesSection" class="mb-12">
                <h2 class="text-4xl font-bold text-center mb-8 text-glow">خدمات تيك توك</h2>
                
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-4 text-center">📌 الأسعار الفرديّة:</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 service-grid">
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">10,000 مشاهدة</h4>
                            <div class="flex justify-center items-center">
                                <span class="text-3xl font-bold text-blue-400 text-center mb-4">5ج</span>
                                <span class="original-price">10ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('views_10k')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">1,000 لايك</h4>
                            <div class="flex justify-center items-center">
                                <span class="text-3xl font-bold text-blue-400 text-center mb-4">10ج</span>
                                <span class="original-price">20ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('likes_1k')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">100 حفظ</h4>
                            <div class="flex justify-center items-center">
                                <span class="text-3xl font-bold text-blue-400 text-center mb-4">2ج</span>
                                <span class="original-price">4ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('saves_100')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">100 مشاركة</h4>
                            <div class="flex justify-center items-center">
                                <span class="text-3xl font-bold text-blue-400 text-center mb-4">1ج</span>
                                <span class="original-price">2ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('shares_100')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">25 كومنت</h4>
                            <div class="flex justify-center items-center">
                                <span class="text-3xl font-bold text-blue-400 text-center mb-4">5ج</span>
                                <span class="original-price">10ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('comment_25')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>

                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">1000 متابع</h4>
                            <div class="flex justify-center items-center">
                                <span class="text-3xl font-bold text-blue-400 text-center mb-4">100ج</span>
                                <span class="original-price">20ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('followers_1k')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-4 text-center">📦 الباقات الجاهزة للتفاعل:</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 service-grid">

                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">📍 باقة المبتدئ 🌟</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>7,500 مشاهدة</li>
                                <li>500 لايك</li>
                                <li>50 حفظ</li>
                                <li>30 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">5ج</span>
                                <span class="original-price">10ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_beginner')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">📍 باقة الأساس</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>15,000 مشاهدة</li>
                                <li>750 لايك</li>
                                <li>100 حفظ</li>
                                <li>80 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">7.5ج</span>
                                <span class="original-price">15ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_basic')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">🚀 باقة النشاط المكثف</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>25,000 مشاهدة</li>
                                <li>1,250 لايك</li>
                                <li>200 حفظ</li>
                                <li>130 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">10ج</span>
                                <span class="original-price">20ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_intensive')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">🔥 باقة التفاعل المركز</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>50,000 مشاهدة</li>
                                <li>2,500 لايك</li>
                                <li>300 حفظ</li>
                                <li>250 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">20ج</span>
                                <span class="original-price">40ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_focused')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">👑 باقة النخبة</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>100,000 مشاهدة</li>
                                <li>5,000 لايك</li>
                                <li>500 حفظ</li>
                                <li>400 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">35ج</span>
                                <span class="original-price">70ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_elite')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">🌟 باقة VIP</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>250,000 مشاهدة</li>
                                <li>10,000 لايك</li>
                                <li>1,000 حفظ</li>
                                <li>750 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">60ج</span>
                                <span class="original-price">120ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_vip')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">💎 باقة التميز</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>500,000 مشاهدة</li>
                                <li>20,000 لايك</li>
                                <li>2,000 حفظ</li>
                                <li>1,500 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">100ج</span>
                                <span class="original-price">200ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_premium')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">🌌 باقة الأسطورة</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>1,000,000 مشاهدة</li>
                                <li>50,000 لايك</li>
                                <li>5,000 حفظ</li>
                                <li>3,000 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">180ج</span>
                                <span class="original-price">360ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_legend')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>
                        <div class="service-card-enhanced">
                            <h4 class="text-xl font-semibold mb-2 text-center">🤑 باقة المليونير</h4>
                            <ul class="list-disc list-inside text-slate-300 mb-4">
                                <li>1,500,000 مشاهدة</li>
                                <li>75,000 لايك</li>
                                <li>10,000 حفظ</li>
                                <li>5,000 مشاركة</li>
                            </ul>
                            <div class="flex justify-center items-center">
                                <span class="text-2xl font-bold text-center text-green-400 mb-4">300ج</span>
                                <span class="original-price">600ج</span>
                                <span class="discount-percent">50%</span>
                            </div>
                            <div class="discount-banner">
                                خصم 50%! ينتهي في <span class="discount-timer"></span>
                            </div>
                            <button onclick="showServiceDetails('package_millionaire')" class="btn-details w-full mt-3">تفاصيل</button>
                        </div>

                    </div>
                </div>

                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6">
                    <h3 class="text-2xl font-bold mb-4 text-center">📌 ملاحظات مهمّة لحضرتك:</h3>
                    <ul class="list-disc list-inside text-slate-300 space-y-2">
                        <li>تفاعل حقيقي مضمون بنسبة 100%</li>
                        <li>الخدمة سريعة جداً، والتسليم بيتم خلال ساعة بإذن الله</li>
                        <li>الدفع بيكون من خلال Vodafone Cash فقط</li>
                        <li>العرض ساري لمدة 14 يوم فقط حتى <span id="discountEndDate"></span></li>
                    </ul>
                </div>
            </section>

            <!-- Stats Section -->
            <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12 stats-grid">
                <div class="stats-card p-6 rounded-xl text-center card-hover">
                    <div class="text-3xl mb-2">📊</div>
                    <div class="text-2xl font-bold text-blue-400" id="totalOrders">+600</div>
                    <div class="text-slate-400">عميل راضي</div>
                </div>
                <div class="stats-card p-6 rounded-xl text-center card-hover">
                    <div class="text-3xl mb-2">⚡</div>
                    <div class="text-2xl font-bold text-green-400">24/7</div>
                    <div class="text-slate-400">دعم فني</div>
                </div>
                <div class="stats-card p-6 rounded-xl text-center card-hover">
                    <div class="text-3xl mb-2">🎯</div>
                    <div class="text-2xl font-bold text-purple-400">100%</div>
                    <div class="text-slate-400">معدل النجاح</div>
                </div>
                <div class="stats-card p-6 rounded-xl text-center card-hover">
                    <div class="text-3xl mb-2">🚀</div>
                    <div class="text-2xl font-bold text-yellow-400">فوري</div>
                    <div class="text-slate-400">بداية الخدمة</div>
                </div>
            </section>
        </div>

        <!-- Orders Page -->
        <div id="ordersPage" class="page-content hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold">طلباتي</h2>
                <div class="flex space-x-4 rtl:space-x-reverse">
                    <select id="orderStatusFilter" class="form-select" onchange="loadUserOrdersPage()">
                        <option value="">جميع الحالات</option>
                        <option value="pending">في الانتظار</option>
                        <option value="processing">قيد التنفيذ</option>
                        <option value="completed">مكتمل</option>
                        <option value="cancelled">ملغي</option>
                    </select>
                </div>
            </div>
            <div id="userOrdersList" class="space-y-4">
                <!-- Orders will be loaded here -->
            </div>
        </div>

        <!-- Balance Page -->
        <div id="balancePage" class="page-content hidden">
            <div class="max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8">إدارة الرصيد</h2>
                
                <div class="balance-card p-8 rounded-xl text-center mb-8">
                    <h3 class="text-2xl font-bold mb-4">رصيدك الحالي</h3>
                    <div class="text-5xl font-bold mb-4" id="currentBalance">0</div>
                    <p class="text-slate-200">يمكنك شحن رصيدك باستخدام فودافون كاش</p>
                </div>

                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4">شحن الرصيد</h3>
                    <form id="balancePageForm" class="space-y-4" onsubmit="handleBalanceCharge(event)">
                        <div>
                            <label class="block text-sm font-medium mb-2">المبلغ (جنيه)</label>
                            <input type="number" id="balancePageAmount" class="form-input w-full" placeholder="5" min="5" required step="0.01">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">طريقة الدفع</label>
                            <select id="balancePagePaymentMethod" class="form-select w-full" required onchange="toggleBalancePageVodafoneNumbers()">
                                <option value="">اختر طريقة الدفع</option>
                                <option value="vodafone_cash">فودافون كاش</option>
                            </select>
                        </div>
                        
                        <div id="balancePageVodafoneNumbers" class="hidden">
                            <label class="block text-sm font-medium mb-2">اختر رقم التحويل</label>
                            <div class="bg-slate-700/50 p-4 rounded-lg space-y-2">
                                <label class="flex items-center space-x-3 rtl:space-x-reverse cursor-pointer">
                                    <input type="radio" name="balancePageTransferNumber" value="01013062296" class="form-radio h-4 w-4 text-blue-600 bg-slate-800 border-slate-600 focus:ring-blue-500" required>
                                    <span class="font-bold text-green-400">01013062296</span>
                                </label>
                                <label class="flex items-center space-x-3 rtl:space-x-reverse cursor-pointer">
                                    <input type="radio" name="balancePageTransferNumber" value="01554887765" class="form-radio h-4 w-4 text-blue-600 bg-slate-800 border-slate-600 focus:ring-blue-500">
                                    <span class="font-bold text-green-400">01554887765</span>
                                </label>
                                <p class="text-sm text-slate-400 pt-2">قم بالتحويل على الرقم الذي اخترته ثم أدخل رقم هاتفك الذي حولت منه.</p>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">رقم الهاتف الذي تم التحويل منه</label>
                            <input type="text" id="balancePageTransactionId" class="form-input w-full" placeholder="أدخل رقم الهاتف" required>
                        </div>
                        
                        <button type="submit" class="btn-primary w-full py-3">إرسال طلب الشحن</button>
                    </form>
                </div>
                
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 mt-8">
                    <h3 class="text-xl font-bold mb-4">سجل المعاملات</h3>
                    <div id="balanceHistory" class="space-y-3">
                        <div class="flex justify-between items-center py-3 border-b border-slate-700">
                            <div>
                                <div class="font-medium">شحن رصيد</div>
                                <div class="text-slate-400 text-sm">20/05/2024 - 14:30</div>
                            </div>
                            <div class="text-green-400 font-semibold">+50 جنيه</div>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-700">
                            <div>
                                <div class="font-medium">طلب خدمة - 10,000 مشاهدة</div>
                                <div class="text-slate-400 text-sm">19/05/2024 - 10:15</div>
                            </div>
                            <div class="text-red-400 font-semibold">-5 جنيه</div>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-700">
                            <div>
                                <div class="font-medium">مكافأة الإحالة</div>
                                <div class="text-slate-400 text-sm">18/05/2024 - 16:45</div>
                            </div>
                            <div class="text-green-400 font-semibold">+10 جنيه</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Page - تم تحسينه -->
        <div id="contactPage" class="page-content hidden">
            <div class="max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8">الدعم الفني</h2>
                
                <div class="user-info-card">
                    <h3 class="text-xl font-bold mb-2">معلومات المستخدم</h3>
                    <div class="text-lg" id="contactUserName">المستخدم: غير مسجل دخول</div>
                    <div class="text-slate-400" id="contactUserPhone"></div>
                </div>
                
                <!-- المحادثات السابقة -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4">المحادثات السابقة</h3>
                    <div id="previousMessages" class="space-y-4">
                        <div class="text-center py-6">
                            <div class="text-4xl mb-4">📨</div>
                            <p class="text-slate-400">لا توجد محادثات سابقة</p>
                        </div>
                    </div>
                </div>
                
                <!-- نموذج إرسال رسالة جديدة - تم تحسينه -->
                <div class="contact-form-improved">
                    <h3 class="text-xl font-bold mb-4">إرسال رسالة جديدة</h3>
                    <form id="contactForm" class="space-y-4" onsubmit="handleContactForm(event)">
                        <div>
                            <label class="block text-sm font-medium mb-2">الموضوع</label>
                            <input type="text" id="contactSubject" class="form-input w-full" placeholder="موضوع الرسالة" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">الرسالة</h3>
                            <textarea id="contactMessage" class="form-input w-full" rows="5" placeholder="اكتب رسالتك هنا..." required></textarea>
                        </div>
                        
                        <button type="submit" class="btn-primary w-full py-3" id="contactSubmitBtn">إرسال الرسالة</button>
                    </form>
                </div>
                
                <!-- معلومات التواصل -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 text-center">
                        <div class="text-3xl mb-4">📱</div>
                        <h3 class="text-lg font-semibold mb-2">واتساب</h3>
                        <p class="text-slate-400">للتواصل السريع</p>
                        <a href="https://wa.me/201013062296" target="_blank" class="btn-primary inline-block px-4 py-2 rounded-lg mt-4">
                            تواصل معنا
                        </a>
                    </div>
                    
                    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 text-center">
                        <div class="text-3xl mb-4">⏰</div>
                        <h3 class="text-lg font-semibold mb-2">ساعات العمل</h3>
                        <p class="text-slate-400">24/7 دعم فني</p>
                        <p class="text-green-400 mt-2">متاحون دائماً</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profilePage" class="page-content hidden"></div>

        <!-- Referral Program Page -->
        <div id="referralPage" class="page-content hidden">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8">نظام الإحالة</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <div class="referral-card">
                        <div class="text-5xl mb-4">🎁</div>
                        <h3 class="text-2xl font-bold mb-2">كسب مع كل إحالة</h3>
                        <p class="mb-4">احصل على 10 جنيه لكل صديق يسجل باستخدام رابطك</p>
                        <div class="text-3xl font-bold text-yellow-300 mb-6">+10 ج</div>
                    </div>
                    
                    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">إحصائيات الإحالة</h3>
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-400" id="referralCount">5</div>
                                <div class="text-slate-400">عدد الأحباب</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-400" id="referralEarnings">50</div>
                                <div class="text-slate-400">إجمالي الأرباح</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-purple-400" id="pendingEarnings">20</div>
                                <div class="text-slate-400">أرباح قيد الانتظار</div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-semibold mb-2">رابط الإحالة الخاص بك</h4>
                            <div class="flex">
                                <input type="text" id="referralLink" class="form-input flex-1 rounded-r-none" value="https://taf3el.com?ref=TAF123" readonly>
                                <button onclick="copyReferralLink()" class="bg-blue-600 hover:bg-blue-700 px-4 rounded-l-none rounded-r-lg transition-colors">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 rtl:space-x-reverse">
                            <button class="btn-primary flex-1 py-2">
                                <i class="fab fa-whatsapp mr-2"></i> مشاركة عبر واتساب
                            </button>
                            <button class="bg-slate-700 hover:bg-slate-600 flex-1 py-2">
                                <i class="fab fa-telegram mr-2"></i> مشاركة عبر تيليجرام
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4">الأحباب المسجلين</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full data-table">
                            <thead>
                                <tr>
                                    <th class="text-right p-4">الاسم</th>
                                    <th class="text-right p-4">رقم الهاتف</th>
                                    <th class="text-right p-4">تاريخ التسجيل</th>
                                    <th class="text-right p-4">الحالة</th>
                                    <th class="text-right p-4">المكسب</th>
                                </tr>
                            </thead>
                            <tbody id="referralsList">
                                <tr>
                                    <td class="p-4">أحمد محمد</td>
                                    <td class="p-4">0123456789</td>
                                    <td class="p-4">15/05/2024</td>
                                    <td class="p-4"><span class="badge badge-success">نشط</span></td>
                                    <td class="p-4 text-green-400">+10 جنيه</td>
                                </tr>
                                <tr>
                                    <td class="p-4">محمود علي</td>
                                    <td class="p-4">0112233445</td>
                                    <td class="p-4">10/05/2024</td>
                                    <td class="p-4"><span class="badge badge-warning">قيد التنشيط</span></td>
                                    <td class="p-4 text-yellow-400">+10 جنيه (معلق)</td>
                                </tr>
                                <tr>
                                    <td class="p-4">سارة خالد</td>
                                    <td class="p-4">0109876543</td>
                                    <td class="p-4">05/05/2024</td>
                                    <td class="p-4"><span class="badge badge-success">نشط</span></td>
                                    <td class="p-4 text-green-400">+10 جنيه</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analyticsPage" class="page-content hidden">
            <div class="max-w-6xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8">التقارير والتحليلات</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stats-card p-6 rounded-xl text-center card-hover">
                        <div class="text-3xl mb-2">📊</div>
                        <div class="text-2xl font-bold text-blue-400" id="totalSpent">350</div>
                        <div class="text-slate-400">إجمالي الصرفيات (جنيه)</div>
                    </div>
                    <div class="stats-card p-6 rounded-xl text-center card-hover">
                        <div class="text-3xl mb-2">🚀</div>
                        <div class="text-2xl font-bold text-green-400">24/7</div>
                        <div class="text-slate-400">دعم فني</div>
                    </div>
                    <div class="stats-card p-6 rounded-xl text-center card-hover">
                        <div class="text-3xl mb-2">🎯</div>
                        <div class="text-2xl font-bold text-purple-400">100%</div>
                        <div class="text-slate-400">معدل النجاح</div>
                    </div>
                </div>
                
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h3 class="text-xl font-bold mb-6">إحصائيات الطلبات الشهرية</h3>
                    <div class="analytics-chart">
                        <div class="chart-bar" style="height: 30%">
                            <span class="chart-bar-label">يناير</span>
                        </div>
                        <div class="chart-bar" style="height: 50%">
                            <span class="chart-bar-label">فبراير</span>
                        </div>
                        <div class="chart-bar" style="height: 70%">
                            <span class="chart-bar-label">مارس</span>
                        </div>
                        <div class="chart-bar" style="height: 90%">
                            <span class="chart-bar-label">أبريل</span>
                        </div>
                        <div class="chart-bar" style="height: 60%">
                            <span class="chart-bar-label">مايو</span>
                        </div>
                        <div class="chart-bar" style="height: 40%">
                            <span class="chart-bar-label">يونيو</span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">الخدمات الأكثر طلباً</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span>10,000 مشاهدة تيك توك</span>
                                    <span>35%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 35%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span>1,000 لايك تيك توك</span>
                                    <span>25%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 25%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span>باقة المبتدئ</span>
                                    <span>20%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 20%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span>1000 متابع تيك توك</span>
                                    <span>15%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 15%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span>خدمات أخرى</span>
                                    <span>5%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 5%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">نشاط الدعم الفني</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span>الرسائل المكتملة</span>
                                    <span>78%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 78%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span>متوسط وقت الرد</span>
                                    <span>32 دقيقة</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 65%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span>رضا العملاء</span>
                                    <span>94%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 94%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="admin-dashboard">
            <div class="admin-panel p-6 mb-8">
                <h2 class="text-3xl font-bold text-center mb-8 text-red-400">⭐ لوحة التحكم الإدارية ⭐</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-7 gap-6 mb-8 admin-grid">
                    <div class="admin-card text-center">
                        <div class="text-2xl mb-2">📦</div>
                        <div class="text-xl font-bold text-blue-400" id="adminNewOrdersCount">0</div>
                        <div class="text-slate-400">طلبات جديده</div>
                    </div>
                    <div class="admin-card text-center">
                        <div class="text-2xl mb-2">⚡</div>
                        <div class="text-xl font-bold text-yellow-400" id="adminActiveOrders">0</div>
                        <div class="text-slate-400">الطلبات النشطة</div>
                    </div>
                    <div class="admin-card text-center">
                        <div class="text-2xl mb-2">✅</div>
                        <div class="text-xl font-bold text-green-400" id="adminCompletedOrders">0</div>
                        <div class="text-slate-400">طلبات مكتملة</div>
                    </div>
                    <div class="admin-card text-center">
                        <div class="text-2xl mb-2">👥</div>
                        <div class="text-xl font-bold text-purple-400" id="adminTotalUsers">0</div>
                        <div class="text-slate-400">إجمالي العملاء</div>
                    </div>
                    <div class="admin-card text-center">
                        <div class="text-2xl mb-2">📨</div>
                        <div class="text-xl font-bold text-blue-400" id="adminNewMessagesCount">0</div>
                        <div class="text-slate-400">رسائل جديده</div>
                    </div>
                    <div class="admin-card text-center">
                        <div class="text-2xl mb-2">💰</div>
                        <div class="text-xl font-bold text-green-400" id="adminTotalBalance">0</div>
                        <div class="text-slate-400">إجمالي شحن الرصيد</div>
                    </div>
                    <!-- بطاقة جديدة لطلبات الشحن الجديدة -->
                    <div class="admin-card text-center">
                        <div class="text-2xl mb-2">💳</div>
                        <div class="text-xl font-bold text-blue-400" id="adminNewBalanceRequests">0</div>
                        <div class="text-slate-400">طلبات شحن جديده</div>
                    </div>
                </div>
                
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6">
                    <div class="admin-tabs-container">
                        <div class="admin-tab active" onclick="showAdminTab('newOrders', this)">الطلبات الجديدة</div>
                        <div class="admin-tab" onclick="showAdminTab('active', this)">الطلبات النشطة</div>
                        <div class="admin-tab" onclick="showAdminTab('completedOrders', this)">الطلبات المكتملة</div>
                        <div class="admin-tab" onclick="showAdminTab('balanceRequests', this)">طلبات الشحن الجديدة</div>
                        <div class="admin-tab" onclick="showAdminTab('completedBalanceRequests', this)">طلبات الشحن المكتملة</div>
                        <div class="admin-tab" onclick="showAdminTab('contactMessages', this)">رسائل العملاء</div>
                        <div class="admin-tab" onclick="showAdminTab('completedMessages', this)">رسائل مكتملة</div>
                        <div class="admin-tab" onclick="showAdminTab('customers', this)">معلومات العملاء</div>
                        <div class="admin-tab" onclick="showAdminTab('profits', this)">تقارير الأرباح</div>
                    </div>

                    <div id="adminNewOrdersTab" class="admin-tab-content">
                        <h3 class="text-xl font-bold mb-4">الطلبات الجديدة</h3>
                        <div id="adminNewOrdersList" class="space-y-4">
                            <!-- New orders will be loaded here -->
                        </div>
                    </div>
                    
                    <div id="adminActiveTab" class="admin-tab-content hidden">
                        <h3 class="text-xl font-bold mb-4">الطلبات النشطة</h3>
                        <div id="activeOrdersList" class="space-y-4">
                            <!-- Active orders will be loaded here -->
                        </div>
                    </div>
                    
                    <div id="adminCompletedOrdersTab" class="admin-tab-content hidden">
                        <h3 class="text-xl font-bold mb-4">الطلبات المكتملة</h3>
                        <div id="completedOrdersList" class="space-y-4">
                            <!-- Completed orders will be loaded here -->
                        </div>
                    </div>
                    
                    <div id="adminBalanceRequestsTab" class="admin-tab-content hidden">
                        <h3 class="text-xl font-bold mb-4">طلبات الشحن الجديدة</h3>
                        <div id="balanceRequestsList" class="space-y-4">
                            <!-- طلبات الشحن تظهر هنا -->
                        </div>
                    </div>
                    
                    <div id="adminCompletedBalanceRequestsTab" class="admin-tab-content hidden">
                        <h3 class="text-xl font-bold mb-4">طلبات الشحن المكتملة</h3>
                        <div id="completedBalanceRequestsList" class="space-y-4">
                            <!-- طلبات الشحن المكتملة تظهر هنا -->
                        </div>
                    </div>
                    
                    <div id="adminContactMessagesTab" class="admin-tab-content hidden">
                        <h3 class="text-xl font-bold mb-4">رسائل العملاء الجديدة</h3>
                        <div id="contactMessagesList" class="space-y-4">
                            <!-- الرسائل تظهر هنا -->
                        </div>
                    </div>
                    
                    <div id="adminCompletedMessagesTab" class="admin-tab-content hidden">
                        <h3 class="text-xl font-bold mb-4">رسائل العملاء المكتملة</h3>
                        <div id="completedMessagesList" class="space-y-4">
                            <!-- الرسائل المكتملة تظهر هنا -->
                        </div>
                    </div>

                    <div id="adminCustomersTab" class="admin-tab-content hidden">
                        <h3 class="text-xl font-bold mb-4">معلومات العملاء</h3>
                        <div class="bg-slate-700/50 rounded-lg overflow-auto max-h-[500px]">
                            <table class="w-full">
                                <thead>
                                    <tr class="bg-slate-800 sticky top-0">
                                        <th class="text-right p-4">الاسم</th>
                                        <th class="text-right p-4">رقم الهاتف</th>
                                        <th class="text-right p-4">الرصيد</th>
                                        <th class="text-right p-4">عدد الطلبات</th>
                                        <th class="text-right p-4">تاريخ التسجيل</th>
                                        <th class="text-right p-4">الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="customersTableBody">
                                    <!-- Customer data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="adminProfitsTab" class="admin-tab-content hidden">
                        <h3 class="text-xl font-bold mb-4">تقارير الأرباح</h3>
                        
                        <div class="profit-summary">
                            <div class="profit-box">
                                <div class="profit-value" id="totalProfit">0 جنيه</div>
                                <div class="profit-label">إجمالي الأرباح</div>
                            </div>
                            <div class="profit-box">
                                <div class="profit-value" id="monthlyProfit">0 جنيه</div>
                                <div class="profit-label">أرباح الشهر الحالي</div>
                            </div>
                            <div class="profit-box">
                                <div class="profit-value" id="lastMonthProfit">0 جنيه</div>
                                <div class="profit-label">أرباح الشهر الماضي</div>
                            </div>
                        </div>
                        
                        <div class="bg-slate-800/50 rounded-xl p-6 mt-6">
                            <h4 class="font-semibold mb-4">تعريف تكلفة الخدمات</h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- الخدمات الفردية -->
                                <div class="bg-slate-700/50 p-4 rounded-lg">
                                    <label class="block text-sm font-medium mb-2">تكلفة 10,000 مشاهدة</label>
                                    <input type="number" id="costViews10k" class="form-input w-full" min="0" value="3" step="0.01">
                                </div>
                                <div class="bg-slate-700/50 p-4 rounded-lg">
                                    <label class="block text-sm font-medium mb-2">تكلفة 1,000 لايك</label>
                                    <input type="number" id="costLikes1k" class="form-input w-full" min="0" value="7" step="0.01">
                                </div>
                                <div class="bg-slate-700/50 p-4 rounded-lg">
                                    <label class="block text-sm font-medium mb-2">تكلفة 100 حفظ</label>
                                    <input type="number" id="costSaves100" class="form-input w-full" min="0" value="1" step="0.01">
                                </div>
                                <div class="bg-slate-700/50 p-4 rounded-lg">
                                    <label class="block text-sm font-medium mb-2">تكلفة 100 مشاركة</label>
                                    <input type="number" id="costShares100" class="form-input w-full" min="0" value="0.5" step="0.01">
                                </div>
                                <div class="bg-slate-700/50 p-4 rounded-lg">
                                    <label class="block text-sm font-medium mb-2">تكلفة 25 كومنت</label>
                                    <input type="number" id="costComment25" class="form-input w-full" min="0" value="3" step="0.01">
                                </div>
                                <div class="bg-slate-700/50 p-4 rounded-lg">
                                    <label class="block text-sm font-medium mb-2">تكلفة 1000 متابع</label>
                                    <input type="number" id="costFollowers1k" class="form-input w-full" min="0" value="6" step="0.01">
                                </div>
                            </div>
                            
                            <button onclick="calculateProfits()" class="btn-primary w-full py-3 mt-6">حساب الأرباح</button>
                            
                            <!-- زر مسح البيانات -->
                            <button onclick="showClearAllDataModal()" class="clear-all-data-btn">
                                مسح جميع البيانات (ما عدا العملاء)
                            </button>
                        </div>
                        
                        <div class="bg-slate-800/50 rounded-xl p-6 mt-6">
                            <h4 class="font-semibold mb-4">تقرير الأرباح الشهرية</h4>
                            
                            <div class="mt-6 overflow-x-auto">
                                <table class="w-full data-table">
                                    <thead>
                                        <tr>
                                            <th class="text-right p-4">الخدمة</th>
                                            <th class="text-right p-4">سعر البيع</th>
                                            <th class="text-right p-4">التكلفة</th>
                                            <th class="text-right p-4">الربح</th>
                                            <th class="text-right p-4">نسبة الربح</th>
                                            <th class="text-right p-4">الشهر</th>
                                        </tr>
                                    </thead>
                                    <tbody id="profitReportTable">
                                        <!-- سيتم تعبئة البيانات هنا -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ===== Firebase SDKs (inserted) ===== -->
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
    <script>
      // Firebase config - REPLACE with your actual keys
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
      };
      firebase.initializeApp(firebaseConfig);
      window.db = firebase.firestore();
    </script>

    <script>
        // Global variables
        let currentUser = null;
        let isAdmin = false;
        let userOrders = [];
        let adminOrders = [];
        let adminMessages = [];
        let allUsers = {};
        let balanceRequests = [];
        let userEdits = [];
        let totalBalanceCharged = 0; // إجمالي شحن الرصيد لكل العملاء
        let serviceCosts = {
            'views_10k': 3,
            'likes_1k': 7,
            'saves_100': 1,
            'shares_100': 0.5,
            'comment_25': 3,
            'followers_1k': 6,
            'package_beginner': 2,
            'package_basic': 4,
            'package_intensive': 6,
            'package_focused': 12,
            'package_elite': 20,
            'package_vip': 35,
            'package_premium': 60,
            'package_legend': 100,
            'package_millionaire': 180
        };
        
        // إضافة متغيرات جديدة
        let discountEndDate = new Date();
        discountEndDate.setDate(discountEndDate.getDate() + 14); // خصم لمدة 14 يوم
        let discountActive = true;
        let profitHistory = [];
        let lastMonthProfit = 0;
        let lastMonthProfitData = [];

        // Service data
        const serviceData = {
            'views_10k': {
                title: '10,000 مشاهدة تيك توك',
                price: 5,
                minQuantity: 500,
                description: 'زيادة مشاهدات الفيديو على تيك توك',
                features: ['مشاهدات حقيقية 100%', 'تسليم سريع خلال ساعة', 'ضمان عدم النقصان']
            },
            'likes_1k': {
                title: '1,000 لايك تيك توك',
                price: 10,
                minQuantity: 50,
                description: 'زيادة الإعجابات على الفيديو',
                features: ['لايكات حقيقية', 'تفاعل طبيعي', 'ضمان الجودة']
            },
            'comment_25': {
                title: '25 كومنت تيك توك',
                price: 0.2,
                minQuantity: 10,
                description: 'زيادة الكومنتات على الفيديو',
                features: ['كومنتات حقيقية', 'تفاعل طبيعي', 'ضمان الجودة']
            },
            'saves_100': {
                title: '100 حفظ تيك توك',
                price: 2,
                minQuantity: 10,
                description: 'زيادة عدد مرات حفظ الفيديو',
                features: ['حفظ حقيقي', 'تحسين الوصول', 'تسليم سريع']
            },
            'shares_100': {
                title: '100 مشاركة تيك توك',
                price: 1,
                minQuantity: 10,
                description: 'زيادة مشاركات الفيديو',
                features: ['مشاركات حقيقية', 'انتشار أوسع', 'تفاعل طبيعي']
            },
            'followers_1k': {
                title: '1000 متابع تيك توك',
                price: 100,
                minQuantity: 10,
                description: 'زيادة المتابعين على الحساب',
                features: ['متابعين حقيقيين', 'نمو طبيعي', 'ضمان عدم الإلغاء']
            },
            'package_beginner': {
                title: 'باقة المبتدئ',
                price: 5,
                minQuantity: 1,
                description: 'باقة شاملة للمبتدئين',
                features: ['7,500 مشاهدة', '500 لايك', '50 حفظ', '30 مشاركة']
            },
            'package_basic': {
                title: 'باقة الأساس',
                price: 7.5,
                minQuantity: 1,
                description: 'باقة أساسية متوازنة',
                features: ['13,500 مشاهدة', '750 لايك', '100 حفظ', '80 مشاركة']
            },
            'package_intensive': {
                title: 'باقة النشاط المكثف',
                price: 10,
                minQuantity: 1,
                description: 'باقة للنشاط المكثف',
                features: ['25,000 مشاهدة', '1,250 لايك', '200 حفظ', '130 مشاركة']
            },
            'package_focused': {
                title: 'باقة التفاعل المركز',
                price: 20,
                minQuantity: 1,
                description: 'باقة للتفاعل المركز',
                features: ['50,000 مشاهدة', '2,500 لايك', '300 حفظ', '250 مشاركة']
            },
            'package_elite': {
                title: 'باقة النخبة',
                price: 35,
                minQuantity: 1,
                description: 'باقة النخبة المتقدمة',
                features: ['100,000 مشاهدة', '5,000 لايك', '500 حفظ', '400 مشاركة']
            },
            'package_vip': {
                title: 'باقة VIP',
                price: 60,
                minQuantity: 1,
                description: 'باقة VIP الحصرية',
                features: ['250,000 مشاهدة', '10,000 لايك', '1,000 حفظ', '750 مشاركة']
            },
            'package_premium': {
                title: 'باقة التميز',
                price: 100,
                minQuantity: 1,
                description: 'باقة التميز الفائقة',
                features: ['500,000 مشاهدة', '20,000 لايك', '2,000 حفظ', '1,500 مشاركة']
            },
            'package_legend': {
                title: 'باقة الأسطورة',
                price: 180,
                minQuantity: 1,
                description: 'الباقة الأسطورية لأكبر تفاعل',
                features: ['1,000,000 مشاهدة', '50,000 لايك', '5,000 حفظ', '3,000 مشاركة']
            },
            'package_millionaire': {
                title: 'باقة المليونير',
                price: 300,
                minQuantity: 1,
                description: 'باقة المليونير لتحطيم الأرقام',
                features: ['1,500,000 مشاهدة', '75,000 لايك', '10,000 حفظ', '5,000 مشاركة']
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            showPage('home');
            
            // Add event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
            document.getElementById('balanceForm').addEventListener('submit', handleBalanceCharge);
            document.getElementById('balancePageForm').addEventListener('submit', handleBalanceCharge);
            document.getElementById('clearDataForm').addEventListener('submit', handleClearAllData);
            
            // Update discount timer
            setInterval(updateDiscountTimer, 1000);
            updateDiscountTimer();
            
            // Set discount end date
            const discountEndEl = document.getElementById('discountEndDate');
            if (discountEndEl) {
                discountEndEl.textContent = discountEndDate.toLocaleDateString('ar-EG');
            }
        });

        // تحديث المؤقت للخصم
        function updateDiscountTimer() {
            if (!discountActive) return;
            
            const now = new Date();
            const diff = discountEndDate - now;
            
            if (diff <= 0) {
                discountActive = false;
                document.querySelectorAll('.discount-timer').forEach(timer => {
                    timer.textContent = 'انتهى العرض!';
                });
                document.querySelectorAll('.discount-banner').forEach(banner => {
                    banner.style.display = 'none';
                });
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            const formattedTime = `${days} يوم ${hours} ساعة ${minutes} دقيقة ${seconds} ثانية`;
            
            document.querySelectorAll('.discount-timer').forEach(timer => {
                timer.textContent = formattedTime;
            });
        }
        
        // تحديث إشعار الدعم الفني
        function updateSupportBadge() {
            if (!currentUser) return;
            
            const newMessages = adminMessages.filter(msg => 
                msg.type === 'contact' && 
                msg.user === currentUser.phone && 
                (!msg.seenByUser || !msg.replies.some(r => r.seenByUser))
            ).length;
            
            const badge = document.getElementById('supportBadge');
            if (newMessages > 0) {
                badge.textContent = newMessages;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
        
        // إضافة ربح عند إكمال الطلب
        function addToProfitHistory(order) {
            const serviceCost = serviceCosts[order.serviceId] || 0;
            const profit = order.totalPrice - serviceCost;
            
            const profitEntry = {
                orderId: order.id,
                serviceName: order.serviceName,
                amount: profit,
                date: new Date().toLocaleString('ar-EG'),
                month: new Date().getMonth(),
                year: new Date().getFullYear()
            };
            
            profitHistory.push(profitEntry);
            saveUserData();
            
            // تحديث تقارير الأرباح
            calculateProfits();
        }
        
        // حساب الأرباح الشهرية
        function calculateMonthlyProfits() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            // أرباح الشهر الحالي
            const currentMonthProfit = profitHistory
                .filter(entry => 
                    entry.month === currentMonth && 
                    entry.year === currentYear)
                .reduce((sum, entry) => sum + entry.amount, 0);
            
            document.getElementById('monthlyProfit').textContent = currentMonthProfit.toFixed(2) + ' جنيه';
            
            // أرباح الشهر الماضي
            lastMonthProfit = profitHistory
                .filter(entry => 
                    entry.month === lastMonth && 
                    entry.year === lastMonthYear)
                .reduce((sum, entry) => sum + entry.amount, 0);
            
            document.getElementById('lastMonthProfit').textContent = lastMonthProfit.toFixed(2) + ' جنيه';
            
            // طلبات الشهر الماضي
            const lastMonthOrders = profitHistory
                .filter(entry => 
                    entry.month === lastMonth && 
                    entry.year === lastMonthYear);
            
            // إجمالي الأرباح
            const totalProfit = profitHistory.reduce((sum, entry) => sum + entry.amount, 0);
            document.getElementById('totalProfit').textContent = totalProfit.toFixed(2) + ' جنيه';
        }

        // Authentication functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        function showSignupModal() {
            document.getElementById('signupModal').classList.remove('hidden');
        }

        function hideSignupModal() {
            document.getElementById('signupModal').classList.add('hidden');
        }

        function showTwoFactorModal() {
            hideLoginModal();
            document.getElementById('twoFactorModal').classList.remove('hidden');
        }

        function hideTwoFactorModal() {
            document.getElementById('twoFactorModal').classList.add('hidden');
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;
            
            // Load all users data
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            
            // Check if user exists and password matches
            if (allUsersData[phone] && allUsersData[phone].password === password) {
                currentUser = {
                    name: allUsersData[phone].name,
                    phone: phone,
                    balance: allUsersData[phone].balance || 0
                };
                
                // Update UI
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userInitial').textContent = currentUser.name.charAt(0);
                document.getElementById('userPhone').textContent = phone;
                
                updateBalanceDisplay();
                showUserProfile();
                    try {
                        if (window.db) {
                            await db.collection('users').doc(order.user).set({ balance: orderUser.balance }, { merge: true });
                        }
                    } catch (err) { console.error('Firestore user balance update error:', err); }
                hideLoginModal();
                saveUserData();
                showNotification('تم تسجيل الدخول بنجاح', 'success');
                subscribeUserMessages(currentUser.phone);
                
                // Reset form
                e.target.reset();
                
                // Update support badge
                updateSupportBadge();
            } else {
                showNotification('بيانات الدخول غير صحيحة', 'error');
            }
        }

        // الدالة المعدلة لإنشاء الحساب
        function handleSignup(e) {
            e.preventDefault();
            
            const name = document.getElementById('signupName').value;
            const phone = document.getElementById('signupPhone').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            // التحقق من تطابق كلمات المرور
            if (password !== confirmPassword) {
                showNotification('كلمات المرور غير متطابقة', 'error');
                return;
            }
            
            // التحقق من وجود المستخدم مسبقاً
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            if (allUsersData[phone]) {
                showNotification('رقم الهاتف مستخدم بالفعل', 'error');
                return;
            }
            
            // إنشاء مستخدم جديد
            currentUser = {
                name: name,
                phone: phone,
                balance: 0,
                referralCode: generateReferralCode()
            };
            
            // حفظ بيانات المستخدم
            allUsersData[phone] = {
                name: name,
                password: password,
                balance: 0,
                registrationDate: new Date().toLocaleString('ar-EG'),
                referralCode: currentUser.referralCode
            };
            
            localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
            
            // تحديث واجهة المستخدم
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userInitial').textContent = currentUser.name.charAt(0);
            document.getElementById('userPhone').textContent = phone;
            
            updateBalanceDisplay();
            showUserProfile();
            hideSignupModal();
            saveUserData();
            
            subscribeUserMessages(currentUser.phone);
            // إظهار رسالة ترحيبية مع رصيد المكافأة
            showNotification('تم إنشاء الحساب بنجاح! ابدأ الآن بطلب خدماتك الأولى.', 'success');
            
            // إعادة تعيين النموذج
            e.target.reset();
        }

        // Data management functions
        async function saveUserData() {
            // تحديث التخزين المحلي (للاستخدام داخل الصفحة فقط)
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            localStorage.setItem('adminOrders', JSON.stringify(adminOrders));
            localStorage.setItem('adminMessages', JSON.stringify(adminMessages));
            
            // حفظ بيانات المستخدم في Firestore
            try {
                if (currentUser && window.db) {
                    await db.collection('users').doc(currentUser.phone).set({
                        name: currentUser.name,
                        phone: currentUser.phone,
                        balance: currentUser.balance,
                        referralCode: currentUser.referralCode || null,
                        lastActive: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                }
            } catch (err) {
                console.error('Firestore saveUserData error:', err);
            }
        }
        function loadUserData() {
            const savedUser = localStorage.getItem('currentUser');
            const savedOrders = localStorage.getItem('userOrders');
            const savedAdminOrders = localStorage.getItem('adminOrders');
            const savedAdminMessages = localStorage.getItem('adminMessages');
            const savedIsAdmin = localStorage.getItem('isAdmin');
            const savedBalanceRequests = localStorage.getItem('balanceRequests');
            const savedUserEdits = localStorage.getItem('userEdits');
            const savedTotalBalanceCharged = localStorage.getItem('totalBalanceCharged');
            const savedServiceCosts = localStorage.getItem('serviceCosts');
            const savedProfitHistory = localStorage.getItem('profitHistory');
            const savedDiscountEndDate = localStorage.getItem('discountEndDate');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userInitial').textContent = currentUser.name.charAt(0);
                document.getElementById('userPhone').textContent = currentUser.phone;
                updateBalanceDisplay();
                showUserProfile();
            }
            
            if (savedOrders) {
                userOrders = JSON.parse(savedOrders);
            }
            
            if (savedAdminOrders) {
                adminOrders = JSON.parse(savedAdminOrders);
            }
            
            if (savedAdminMessages) {
                adminMessages = JSON.parse(savedAdminMessages);
            }
            
            if (savedBalanceRequests) {
                balanceRequests = JSON.parse(savedBalanceRequests);
            }
            
            if (savedUserEdits) {
                userEdits = JSON.parse(savedUserEdits);
            }
            
            if (savedTotalBalanceCharged) {
                totalBalanceCharged = parseFloat(savedTotalBalanceCharged);
            }
            
            if (savedServiceCosts) {
                serviceCosts = JSON.parse(savedServiceCosts);
            }
            
            if (savedProfitHistory) {
                profitHistory = JSON.parse(savedProfitHistory);
            }
            
            if (savedDiscountEndDate) {
                discountEndDate = new Date(savedDiscountEndDate);
            }
            
            if (savedIsAdmin === 'true') {
                isAdmin = true;
                showAdminAccess();
            }
            
            // Load all users data
            allUsers = JSON.parse(localStorage.getItem('allUsersData')) || {};
        }

        function saveAllUsersData() {
            const allUsers = JSON.parse(localStorage.getItem('allUsersData')) || {};
            if (currentUser) {
                allUsers[currentUser.phone] = {
                    name: currentUser.name,
                    phone: currentUser.phone,
                    password: allUsers[currentUser.phone]?.password || '',
                    balance: currentUser.balance,
                    registrationDate: allUsers[currentUser.phone]?.registrationDate || new Date().toLocaleString('ar-EG'),
                    referralCode: currentUser.referralCode || generateReferralCode()
                };
            }
            localStorage.setItem('allUsersData', JSON.stringify(allUsers));
        }

        function updateBalanceDisplay() {
            if (currentUser) {
                const balanceValue = currentUser.balance.toFixed(2);
                document.getElementById('userBalance').textContent = `${balanceValue} جنيه`;
                document.getElementById('currentBalance').textContent = balanceValue;
                
                // Update balance in header
                const balanceElement = document.getElementById('headerBalance');
                if (balanceElement) {
                    balanceElement.textContent = `رصيدك: ${balanceValue} جنيه`;
                }
            }
        }


        /* ================= Firebase helper functions ================= */
        async function updateOrderStatusInFirestore(localId, newStatus) {
            try {
                if (!window.db) return;
                const q = await db.collection('orders').where('id', '==', localId).limit(1).get();
                if (!q.empty) {
                    await q.docs[0].ref.update({ status: newStatus });
                }
            } catch (err) { console.error('Firestore update order status error:', err); }
        }

        async function updateMessageInFirestore(localId, patch) {
            try {
                if (!window.db) return;
                const q = await db.collection('messages').where('id', '==', localId).limit(1).get();
                if (!q.empty) {
                    await q.docs[0].ref.update(patch);
                }
            } catch (err) { console.error('Firestore update message error:', err); }
        }

        let unsubUserMsgs = null;
        function subscribeUserMessages(phone) {
            try {
                if (!window.db) return;
                if (unsubUserMsgs) unsubUserMsgs();
                unsubUserMsgs = db.collection('messages')
                    .where('user', '==', phone)
                    .onSnapshot((snap) => {
                        const msgs = [];
                        snap.forEach(doc => msgs.push(doc.data()));
                        adminMessages = msgs;
                        // تحديث واجهة المستخدم لقسم الدعم في حساب المستخدم
                        if (document.getElementById('supportSection')) {
                            loadPreviousMessages();
                        }
                        updateSupportBadge();
                    });
            } catch (err) { console.error('Firestore subscribe user messages error:', err); }
        }

        let unsubOrders = null, unsubMessages = null;
        function subscribeAdminCollections() {
            try {
                if (!window.db) return;
                if (unsubOrders) unsubOrders();
                if (unsubMessages) unsubMessages();
                unsubOrders = db.collection('orders')
                    .onSnapshot((snap) => {
                        const arr = [];
                        snap.forEach(doc => arr.push(doc.data()));
                        adminOrders = arr;
                        // إعادة تحميل التابات المهمة
                        loadNewOrdersTab();
                        loadActiveOrdersTab();
                        loadCompletedOrdersTab();
                        loadAdminStats();
                    });
                unsubMessages = db.collection('messages')
                    .onSnapshot((snap) => {
                        const arr = [];
                        snap.forEach(doc => arr.push(doc.data()));
                        adminMessages = arr;
                        updateSupportBadge();
                        // إذا كان المدير يعرض تبويب الرسائل الآن، حدّثه
                        loadContactMessagesTab();
                    });
            } catch (err) { console.error('Firestore subscribe admin collections error:', err); }
        }
        /* ================= End Firebase helpers ================= */

        // UI functions
        function showPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.classList.add('hidden'));
            
            // Hide admin dashboard
            document.getElementById('adminDashboard').classList.remove('show');
            
            // Show selected page
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            
            // Update navigation
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.remove('text-blue-400', 'border-b-2', 'border-blue-400');
                btn.classList.add('hover:text-blue-400');
            });
            
            // Load page-specific content
            if (pageId === 'orders') {
                loadUserOrdersPage();
            } else if (pageId === 'balance') {
                updateBalanceDisplay();
            } else if (pageId === 'referral') {
                loadReferralData();
            } else if (pageId === 'analytics') {
                loadAnalyticsData();
            } else if (pageId === 'contact') {
                loadContactPage();
            }
        }

        function loadContactPage() {
            if (currentUser) {
                document.getElementById('contactUserName').textContent = `المستخدم: ${currentUser.name}`;
                document.getElementById('contactUserPhone').textContent = `رقم الهاتف: ${currentUser.phone}`;
                loadPreviousMessages();
            } else {
                document.getElementById('contactUserName').textContent = 'المستخدم: غير مسجل دخول';
                document.getElementById('contactUserPhone').textContent = '';
            }
        }

        function scrollToServices() {
            showPage('home');
            setTimeout(() => {
                document.getElementById('servicesSection').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function showUserProfile() {
            document.getElementById('userProfile').classList.remove('hidden');
            document.getElementById('authButtons').classList.add('hidden');
            updateBalanceDisplay();
        }

        function hideUserProfile() {
            document.getElementById('userProfile').classList.add('hidden');
            document.getElementById('authButtons').classList.remove('hidden');
        }

        function showAdminAccess() {
            document.getElementById('adminNav').classList.remove('hidden');
        }

        function hideAdminAccess() {
            document.getElementById('adminNav').classList.add('hidden');
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        }

        function showAdminModal() {
            if (isAdmin) {
                showAdminDashboard();
                subscribeAdminCollections();
            } else {
                document.getElementById('adminModal').classList.remove('hidden');
            }
        }

        function hideAdminModal() {
            document.getElementById('adminModal').classList.add('hidden');
        }

        function showBalanceModal() {
            document.getElementById('balanceModal').classList.remove('hidden');
        }

        function hideBalanceModal() {
            document.getElementById('balanceModal').classList.add('hidden');
        }

        function toggleVodafoneNumbers() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            const vodafoneDiv = document.getElementById('vodafoneNumbers');
            
            if (paymentMethod === 'vodafone_cash') {
                vodafoneDiv.classList.remove('hidden');
            } else {
                vodafoneDiv.classList.add('hidden');
            }
        }

        function toggleBalancePageVodafoneNumbers() {
            const paymentMethod = document.getElementById('balancePagePaymentMethod').value;
            const vodafoneDiv = document.getElementById('balancePageVodafoneNumbers');
            
            if (paymentMethod === 'vodafone_cash') {
                vodafoneDiv.classList.remove('hidden');
            } else {
                vodafoneDiv.classList.add('hidden');
            }
        }

        // Service functions
        function showServiceDetails(serviceId) {
            const service = serviceData[serviceId];
            if (!service) return;
            
            const modal = document.getElementById('serviceDetailsModal');
            document.getElementById('serviceTitle').textContent = service.title;
            
            document.getElementById('serviceInfo').innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h5 class="font-semibold mb-2">الوصف</h5>
                        <p class="text-slate-300">${service.description}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-semibold mb-2">السعر</h5>
                            <p class="text-2xl font-bold text-green-400">${service.price} جنيه</p>
                        </div>
                        <div>
                            <h5 class="font-semibold mb-2">الحد الأدنى</h5>
                            <p class="text-lg font-semibold">${service.minQuantity.toLocaleString()}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h5 class="font-semibold mb-2">المميزات</h5>
                        <ul class="list-disc list-inside text-slate-300 space-y-1">
                            ${service.features.map(feature => `<li>${feature}</li>`).join("")}
                        </ul>
                    </div>
                </div>
            `;
            
            // Set current service for form
            document.getElementById('serviceOrderForm').dataset.serviceId = serviceId;
            
            // Show/hide quantity field for packages
            const quantityField = document.getElementById('quantityField');
            if (serviceId.startsWith('package_')) {
                quantityField.style.display = 'none';
                document.getElementById('quantity').value = 1;
            } else {
                quantityField.style.display = 'block';
                document.getElementById('quantity').value = service.minQuantity;
            }
            
            calculateTotalPrice();
            modal.classList.add('show');
        }

        function closeServiceModal() {
            document.getElementById('serviceDetailsModal').classList.remove('show');
        }

        function calculateTotalPrice() {
            const form = document.getElementById("serviceOrderForm");
            const serviceId = form.dataset.serviceId;
            const service = serviceData[serviceId];
            
            if (!service) return;
            
            const quantityInput = document.getElementById("quantity");
            let quantity = parseInt(quantityInput.value) || service.minQuantity;
            const quantityError = document.getElementById("quantityError");
            
            // Validate quantity against minQuantity only
            if (quantity < service.minQuantity) {
                quantityError.textContent = `الحد الأدنى: ${service.minQuantity.toLocaleString()}`;
                quantityError.classList.remove("hidden");
                return;
            } else {
                quantityError.classList.add("hidden");
            }
            
            let totalPrice;
            if (serviceId.startsWith("package_")) {
                totalPrice = service.price * quantity;
            } else {
                const baseQuantity = parseInt(serviceId.includes('views') ? '10000' : 
                                           serviceId.includes('likes') ? '1000' : 
                                           serviceId.includes('saves') ? '100' : 
                                           serviceId.includes('shares') ? '100' : 
                                           serviceId.includes('followers') ? '1000' : '1');
                totalPrice = (service.price / baseQuantity) * quantity;
            }
            
            document.getElementById("totalPrice").textContent = `${totalPrice.toFixed(2)} جنيه`;
        }

        async function handleServiceOrder(e) {
            e.preventDefault();

            if (!currentUser) {
                showNotification('يجب تسجيل الدخول أولاً لإنشاء طلب', 'error');
                return;
            }
            
            const form = e.target;
            const serviceId = form.dataset.serviceId;
            const service = serviceData[serviceId];
            
            if (!service) {
                showNotification('خطأ في بيانات الخدمة', 'error');
                return;
            }
            
            const contentLink = document.getElementById('contentLink').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const notes = document.getElementById('orderNotes').value;
            
            if (quantity < service.minQuantity) {
                showNotification(`الحد الأدنى للكمية: ${service.minQuantity.toLocaleString()}`, 'error');
                return;
            }
            
            let totalPrice;
            if (serviceId.startsWith("package_")) {
                totalPrice = service.price * quantity;
            } else {
                const baseQuantity = parseInt(serviceId.includes('views') ? '10000' : 
                                           serviceId.includes('likes') ? '1000' : 
                                           serviceId.includes('saves') ? '100' : 
                                           serviceId.includes('shares') ? '100' : 
                                           serviceId.includes('followers') ? '1000' : '1');
                totalPrice = (service.price / baseQuantity) * quantity;
            }
            
            const finalPrice = parseFloat(totalPrice.toFixed(2));

            // Check balance before deduction
            if (currentUser.balance < finalPrice) {
                showNotification(`رصيدك غير كافٍ. الرصيد الحالي: ${currentUser.balance.toFixed(2)} جنيه`, 'error');
                return;
            }

            // Deduct amount from balance
            currentUser.balance = parseFloat((currentUser.balance - finalPrice).toFixed(2));
            updateBalanceDisplay();
            
            const order = {
                id: Date.now(),
                serviceId: serviceId,
                serviceName: service.title,
                contentLink: contentLink,
                quantity: quantity,
                totalPrice: finalPrice,
                notes: notes,
                status: 'pending',
                timestamp: new Date().toLocaleString('ar-EG'),
                user: currentUser.phone
            };
            
            userOrders.push(order);
            adminOrders.push(order);
            
            saveAllUsersData();
            saveUserData();
            // مزامنة مع Firestore
            try {
                if (window.db) {
                    await db.collection('orders').add({
                        ...order,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    await db.collection('users').doc(currentUser.phone).set({
                        balance: currentUser.balance
                    }, { merge: true });
                }
            } catch (err) {
                console.error('Firestore add order error:', err);
            }
            
            
            closeServiceModal();
            showNotification(`تم إرسال طلبك وخصم ${finalPrice} جنيه من رصيدك بنجاح!`, 'success');
            
            form.reset();
        }

        // Order management functions
        function loadUserOrdersPage() {
            const ordersList = document.getElementById('userOrdersList');
            
            if (userOrders.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">📦</div>
                        <h3 class="text-xl font-semibold mb-2">لا توجد طلبات حتى الآن</h3>
                        <p class="text-slate-400 mb-4">ابدأ بطلب خدمة من صفحة الخدمات</p>
                        <button onclick="scrollToServices(); showPage('home');" class="btn-primary px-6 py-2 rounded-lg">
                            تصفح الخدمات
                        </button>
                    </div>
                `;
                return;
            }
            
            const filteredOrders = userOrders.filter(order => {
                const statusFilter = document.getElementById('orderStatusFilter').value;
                return !statusFilter || order.status === statusFilter;
            });
            
            ordersList.innerHTML = filteredOrders.map(order => `
                <div class="order-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-semibold text-lg">${order.serviceName}</h4>
                            <p class="text-slate-400 text-sm">طلب #${order.id}</p>
                        </div>
                        <span class="badge badge-${getStatusColor(order.status)}">${getStatusText(order.status)}</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <span class="text-slate-400 text-sm">الكمية:</span>
                            <span class="font-semibold">${order.quantity.toLocaleString()}</span>
                        </div>
                        <div>
                            <span class="text-slate-400 text-sm">السعر:</span>
                            <span class="font-semibold text-green-400">${order.totalPrice.toFixed(2)} جنيه</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <span class="text-slate-400 text-sm">الرابط:</span>
                        <a href="${order.contentLink}" target="_blank" class="text-blue-400 hover:underline text-sm break-all">
                            ${order.contentLink}
                        </a>
                    </div>
                    
                    ${order.notes ? `
                        <div class="mb-4">
                            <span class="text-slate-400 text-sm">ملاحظات:</span>
                            <p class="text-sm">${order.notes}</p>
                        </div>
                    ` : ''}
                    
                    <div class="text-slate-400 text-sm">
                        تاريخ الطلب: ${order.timestamp}
                    </div>
                </div>
            `).join('');
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'في الانتظار',
                'processing': 'قيد التنفيذ',
                'completed': 'مكتمل',
                'cancelled': 'ملغي'
            };
            return statusMap[status] || status;
        }

        function getStatusColor(status) {
            const colorMap = {
                'pending': 'warning',
                'processing': 'info',
                'completed': 'success',
                'cancelled': 'error'
            };
            return colorMap[status] || 'info';
        }

        // الدالة المعدلة لإرسال الرسائل
        async function handleContactForm(e) {
            e.preventDefault();

            if (!currentUser) {
                showNotification('يجب تسجيل الدخول أولاً لإرسال رسالة', 'error');
                return;
            }

            const submitButton = document.getElementById('contactSubmitBtn');
            submitButton.disabled = true;
            submitButton.classList.add('btn-disabled');

            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;

            // إنشاء رسالة واحدة فقط
            const contactMessage = {
            // مزامنة الرسالة مع Firestore
            try {
                if (window.db) {
                    await db.collection('messages').add({
                        ...contactMessage,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            } catch (err) {
                console.error('Firestore add message error:', err);
            }
            
                id: Date.now(),
                type: 'contact',
                name: currentUser.name,
                phone: currentUser.phone,
                subject: subject,
                content: message,
                timestamp: new Date().toLocaleString('ar-EG'),
                user: currentUser.phone,
                status: 'new',
                replies: []
            };

            // إضافة الرسالة مرة واحدة فقط
            adminMessages.push(contactMessage);
            saveUserData();

            showNotification('تم إرسال رسالتك بنجاح! سنتواصل معك قريباً', 'success');
            e.target.reset();
            
            // تحديث قائمة الرسائل
            loadPreviousMessages();
            updateSupportBadge();
            
            // إعادة تمكين الزر بعد 2 ثانية لمنع الإرسال المتكرر
            setTimeout(() => {
                submitButton.disabled = false;
                submitButton.classList.remove('btn-disabled');
            }, 2000);
        }

        function loadPreviousMessages() {
            const container = document.getElementById('previousMessages');
            if (!container || !currentUser) return;

            // Filter messages for current user
            const userMessages = adminMessages.filter(msg => 
                msg.type === 'contact' && msg.user === currentUser.phone
            );

            if (userMessages.length === 0) {
                container.innerHTML = '<p class="text-center text-slate-400">لا توجد محادثات سابقة</p>';
                return;
            }

            container.innerHTML = userMessages.map(msg => `
                <div class="message-thread">
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-semibold">${msg.subject}</h4>
                        <span class="text-slate-400 text-sm">${msg.timestamp}</span>
                    </div>
                    
                    <div class="user-message">
                        <div class="message-header">
                            <span>${msg.name}</span>
                            <span>${msg.timestamp}</span>
                        </div>
                        <p>${msg.content}</p>
                    </div>
                    
                    ${msg.replies && msg.replies.length > 0 ? 
                        msg.replies.map(reply => `
                            <div class="admin-reply">
                                <div class="message-header">
                                    <span>الدعم الفني</span>
                                    <span>${reply.timestamp}</span>
                                </div>
                                <p>${reply.content}</p>
                            </div>
                        `).join('') 
                    : `
                        <div class="text-slate-400 text-sm text-center py-4">لم يتم الرد بعد</div>
                    `}
                </div>
            `).join('');
        }

        function handleBalanceCharge(e) {
            e.preventDefault();
            
            let amount, paymentMethod, transactionId, transferTo;
            
            // Check which form was submitted
            if (e.target.id === 'balanceForm') {
                amount = parseFloat(document.getElementById('chargeAmount').value);
                paymentMethod = document.getElementById('paymentMethod').value;
                transactionId = document.getElementById('transactionId').value;
                
                // Get selected Vodafone number
                const selectedRadio = document.querySelector('input[name="transferNumber"]:checked');
                if (selectedRadio) {
                    transferTo = selectedRadio.value;
                } else {
                    showNotification('يرجى اختيار رقم التحويل', 'error');
                    return;
                }
            } else {
                amount = parseFloat(document.getElementById('balancePageAmount').value);
                paymentMethod = document.getElementById('balancePagePaymentMethod').value;
                transactionId = document.getElementById('balancePageTransactionId').value;
                
                // Get selected Vodafone number
                const selectedRadio = document.querySelector('input[name="balancePageTransferNumber"]:checked');
                if (selectedRadio) {
                    transferTo = selectedRadio.value;
                } else {
                    showNotification('يرجى اختيار رقم التحويل', 'error');
                    return;
                }
            }
            
            if (!paymentMethod) {
                showNotification('يرجى اختيار طريقة الدفع', 'error');
                return;
            }
            
            const chargeRequest = {
                id: Date.now(),
                type: 'balance_charge',
                amount: amount,
                paymentMethod: paymentMethod,
                transactionId: transactionId,
                transferTo: transferTo, // Add the selected Vodafone number
                timestamp: new Date().toLocaleString('ar-EG'),
                user: currentUser ? currentUser.phone : 'guest',
                status: 'pending'
            };
            
            balanceRequests.push(chargeRequest);
            adminMessages.push(chargeRequest);
            saveUserData();
            
            // إضافة رسالة توضيحية جديدة
            showNotification(`
                تم إرسال طلب الشحن! 
                الرجاء التحويل إلى أحد الأرقام التالية: 
                01013062296 أو 01554887765
                بعد التحويل، سيقوم فريقنا بتأكيد شحن رصيدك في أقرب وقت.
                شكرًا لصبرك.
            `, 'info');
            
            e.target.reset();
            if (e.target.id === 'balanceForm') {
                document.getElementById('vodafoneNumbers').classList.add('hidden');
                hideBalanceModal();
            } else {
                document.getElementById('balancePageVodafoneNumbers').classList.add('hidden');
            }
        }

        // Referral system functions
        function loadReferralData() {
            document.getElementById('referralCount').textContent = '5';
            document.getElementById('referralEarnings').textContent = '50';
            document.getElementById('pendingEarnings').textContent = '20';
            document.getElementById('referralLink').value = `https://taf3el.com?ref=${currentUser.referralCode}`;
        }

        function generateReferralCode() {
            return 'TAF' + Math.floor(100000 + Math.random() * 900000);
        }

        function copyReferralLink() {
            const linkInput = document.getElementById('referralLink');
            linkInput.select();
            document.execCommand('copy');
            showNotification('تم نسخ رابط الإحالة بنجاح', 'success');
        }

        // Analytics functions
        function loadAnalyticsData() {
            document.getElementById('totalSpent').textContent = '350';
            document.getElementById('completedOrders').textContent = '42';
            document.getElementById('referralAnalytics').textContent = '5';
        }

        // Admin functions
        function handleAdminLogin(e) {
            e.preventDefault();
            
            const password = document.getElementById('adminPassword').value;
            
            if (password === 'kimo777kimo' || password === 'ahmed777ahmed') {
                isAdmin = true;
                localStorage.setItem('isAdmin', 'true');
                showAdminAccess();
                hideAdminModal();
                showNotification('تم تسجيل دخول المدير بنجاح', 'success');
                showAdminDashboard();
            } else {
                showNotification('كلمة مرور خاطئة', 'error');
            }
            
            e.target.reset();
        }

        function showAdminDashboard() {
            // Hide all pages
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.classList.add('hidden'));
            
            // Show admin dashboard
            document.getElementById('adminDashboard').classList.add('show');
            
            // Load admin data
            loadAdminStats();
            showAdminTab('newOrders');
        }

        function loadAdminStats() {
            // طلبات جديدة
            const newOrdersCount = adminOrders.filter(o => o.status === 'pending').length;
            document.getElementById('adminNewOrdersCount').textContent = newOrdersCount;
            
            // طلبات نشطة
            const activeOrders = adminOrders.filter(o => o.status === 'processing').length;
            document.getElementById('adminActiveOrders').textContent = activeOrders;
            
            // طلبات مكتملة
            const completedOrders = adminOrders.filter(o => o.status === 'completed').length;
            document.getElementById('adminCompletedOrders').textContent = completedOrders;
            
            // إجمالي العملاء
            const allUsers = JSON.parse(localStorage.getItem('allUsersData')) || {};
            document.getElementById('adminTotalUsers').textContent = Object.keys(allUsers).length;
            
            // رسائل جديدة
            const contactMessages = adminMessages.filter(m => m.type === 'contact' && m.status === 'new');
            document.getElementById('adminNewMessagesCount').textContent = contactMessages.length;
            
            // إجمالي شحن الرصيد
            const totalBalance = balanceRequests
                .filter(req => req.status === 'completed')
                .reduce((sum, req) => sum + parseFloat(req.amount), 0);
            document.getElementById('adminTotalBalance').textContent = totalBalance.toFixed(2);
            
            // طلبات شحن جديدة
            const newBalanceRequests = balanceRequests.filter(req => req.status === 'pending').length;
            document.getElementById('adminNewBalanceRequests').textContent = newBalanceRequests;
        }

        function showAdminTab(tabName, buttonElement) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.admin-tab-content');
            tabs.forEach(tab => tab.classList.add('hidden'));
            
            // Show selected tab
            const selectedTab = document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`);
            if (selectedTab) {
                selectedTab.classList.remove('hidden');
            }

            // Update tab buttons styling
            const tabButtons = document.querySelectorAll('.admin-tab');
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Load the correct data for the selected tab
            if (tabName === 'newOrders') {
                loadNewOrdersTab();
            } else if (tabName === 'active') {
                loadActiveOrdersTab();
            } else if (tabName === 'completedOrders') {
                loadCompletedOrdersTab();
            } else if (tabName === 'balanceRequests') {
                loadBalanceRequestsTab();
            } else if (tabName === 'completedBalanceRequests') {
                loadCompletedBalanceRequestsTab();
            } else if (tabName === 'contactMessages') {
                loadContactMessagesTab();
            } else if (tabName === 'completedMessages') {
                loadCompletedMessagesTab();
            } else if (tabName === 'customers') {
                loadCustomersTab();
            } else if (tabName === 'profits') {
                loadProfitsTab();
            }
        }

        function loadNewOrdersTab() {
            const ordersList = document.getElementById('adminNewOrdersList');
            const newOrders = adminOrders.filter(order => order.status === 'pending');
            
            if (newOrders.length === 0) {
                ordersList.innerHTML = '<p class="text-center text-slate-400">لا توجد طلبات جديدة</p>';
                return;
            }
            
            ordersList.innerHTML = newOrders.map(order => `
                <div class="admin-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-semibold text-lg">${order.serviceName}</h4>
                            <p class="text-slate-400 text-sm">طلب #${order.id} - ${order.user}</p>
                        </div>
                        <span class="badge badge-warning">في الانتظار</span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <span class="text-slate-400 text-sm">الكمية:</span>
                            <span class="font-semibold">${order.quantity.toLocaleString()}</span>
                        </div>
                        <div>
                            <span class="text-slate-400 text-sm">السعر:</span>
                            <span class="font-semibold text-green-400">${order.totalPrice.toFixed(2)} جنيه</span>
                        </div>
                        <div>
                            <span class="text-slate-400 text-sm">التاريخ:</span>
                            <span class="text-sm">${order.timestamp}</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <span class="text-slate-400 text-sm">الرابط:</span>
                        <a href="${order.contentLink}" target="_blank" class="text-blue-400 hover:underline text-sm break-all">
                            ${order.contentLink}
                        </a>
                    </div>
                    
                    ${order.notes ? `
                        <div class="mb-4">
                            <span class="text-slate-400 text-sm">ملاحظات:</span>
                            <p class="text-sm">${order.notes}</p>
                        </div>
                    ` : ''}
                    
                    <div class="flex space-x-2 rtl:space-x-reverse">
                        <button onclick="approveOrder(${order.id})" class="btn-primary px-4 py-2 rounded-lg text-sm">
                            قبول
                        </button>
                        <button onclick="rejectOrder(${order.id})" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm transition-colors">
                            رفض
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadActiveOrdersTab() {
            const ordersList = document.getElementById('activeOrdersList');
            const activeOrders = adminOrders.filter(order => order.status === 'processing');
            
            if (activeOrders.length === 0) {
                ordersList.innerHTML = '<p class="text-center text-slate-400">لا توجد طلبات نشطة</p>';
                return;
            }
            
            ordersList.innerHTML = activeOrders.map(order => `
                <div class="admin-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-semibold text-lg">${order.serviceName}</h4>
                            <p class="text-slate-400 text-sm">طلب #${order.id} - ${order.user}</p>
                        </div>
                        <span class="badge badge-info">قيد التنفيذ</span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <span class="text-slate-400 text-sm">الكمية:</span>
                            <span class="font-semibold">${order.quantity.toLocaleString()}</span>
                        </div>
                        <div>
                            <span class="text-slate-400 text-sm">السعر:</span>
                            <span class="font-semibold text-green-400">${order.totalPrice.toFixed(2)} جنيه</span>
                        </div>
                        <div>
                            <span class="text-slate-400 text-sm">التاريخ:</span>
                            <span class="text-sm">${order.timestamp}</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <span class="text-slate-400 text-sm">الرابط:</span>
                        <a href="${order.contentLink}" target="_blank" class="text-blue-400 hover:underline text-sm break-all">
                            ${order.contentLink}
                        </a>
                    </div>
                    
                    <div class="flex space-x-2 rtl:space-x-reverse">
                        <button onclick="completeOrder(${order.id})" class="btn-primary px-4 py-2 rounded-lg text-sm">
                            تم الانتهاء
                        </button>
                        <button onclick="cancelOrder(${order.id})" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm">
                            إلغاء الطلب
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadCompletedOrdersTab() {
            const ordersList = document.getElementById('completedOrdersList');
            const completedOrders = adminOrders.filter(order => order.status === 'completed');
            
            if (completedOrders.length === 0) {
                ordersList.innerHTML = '<p class="text-center text-slate-400">لا توجد طلبات مكتملة</p>';
                return;
            }
            
            ordersList.innerHTML = completedOrders.map(order => `
                <div class="admin-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-semibold text-lg">${order.serviceName}</h4>
                            <p class="text-slate-400 text-sm">طلب #${order.id} - ${order.user}</p>
                        </div>
                        <span class="badge badge-success">مكتمل</span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <span class="text-slate-400 text-sm">الكمية:</span>
                            <span class="font-semibold">${order.quantity.toLocaleString()}</span>
                        </div>
                        <div>
                            <span class="text-slate-400 text-sm">السعر:</span>
                            <span class="font-semibold text-green-400">${order.totalPrice.toFixed(2)} جنيه</span>
                        </div>
                        <div>
                            <span class="text-slate-400 text-sm">التاريخ:</span>
                            <span class="text-sm">${order.timestamp}</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <span class="text-slate-400 text-sm">الرابط:</span>
                        <a href="${order.contentLink}" target="_blank" class="text-blue-400 hover:underline text-sm break-all">
                            ${order.contentLink}
                        </a>
                    </div>
                    
                    ${order.notes ? `
                        <div class="mb-4">
                            <span class="text-slate-400 text-sm">ملاحظات:</span>
                            <p class="text-sm">${order.notes}</p>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function loadBalanceRequestsTab() {
            const requestsList = document.getElementById('balanceRequestsList');
            const pendingRequests = balanceRequests.filter(req => req.status === 'pending');
            
            if (pendingRequests.length === 0) {
                requestsList.innerHTML = '<p class="text-center text-slate-400">لا توجد طلبات شحن جديدة</p>';
                return;
            }
            
            requestsList.innerHTML = pendingRequests.map(request => `
                <div class="admin-card">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold">طلب شحن رصيد</h4>
                        <span class="text-slate-400 text-sm">${request.timestamp}</span>
                    </div>
                    
                    <div class="space-y-2 text-sm mb-4">
                        <div><span class="text-slate-400">المبلغ:</span> ${request.amount} جنيه</div>
                        <div><span class="text-slate-400">طريقة الدفع:</span> ${request.paymentMethod}</div>
                        <div><span class="text-slate-400">تم التحويل إلى:</span> ${request.transferTo}</div>
                        <div><span class="text-slate-400">رقم الهاتف:</span> ${request.user}</div>
                        <div><span class="text-slate-400">رقم التحويل:</span> ${request.transactionId}</div>
                    </div>
                    
                    <div class="flex space-x-2 rtl:space-x-reverse">
                        <button onclick="approveBalanceRequest(${request.id})" class="btn-primary px-4 py-2 rounded-lg text-sm">
                            قبول
                        </button>
                        <button onclick="rejectBalanceRequest(${request.id})" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm transition-colors">
                            رفض
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadCompletedBalanceRequestsTab() {
            const requestsList = document.getElementById('completedBalanceRequestsList');
            const completedRequests = balanceRequests.filter(req => req.status === 'completed' || req.status === 'cancelled');
            
            if (completedRequests.length === 0) {
                requestsList.innerHTML = '<p class="text-center text-slate-400">لا توجد طلبات شحن مكتملة</p>';
                return;
            }
            
            requestsList.innerHTML = completedRequests.map(request => `
                <div class="admin-card">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold">طلب شحن رصيد</h4>
                        <span class="text-slate-400 text-sm">${request.timestamp}</span>
                    </div>
                    
                    <div class="space-y-2 text-sm mb-4">
                        <div><span class="text-slate-400">المبلغ:</span> ${request.amount} جنيه</div>
                        <div><span class="text-slate-400">طريقة الدفع:</span> ${request.paymentMethod}</div>
                        <div><span class="text-slate-400">تم التحويل إلى:</span> ${request.transferTo}</div>
                        <div><span class="text-slate-400">رقم الهاتف:</span> ${request.user}</div>
                        <div><span class="text-slate-400">رقم التحويل:</span> ${request.transactionId}</div>
                        <div><span class="text-slate-400">الحالة:</span> 
                            <span class="${request.status === 'completed' ? 'text-green-400' : 'text-red-400'}">
                                ${request.status === 'completed' ? 'مكتمل' : 'ملغي'}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function loadContactMessagesTab() {
            const messagesList = document.getElementById('contactMessagesList');
            const contactMessages = adminMessages.filter(msg => msg.type === 'contact' && msg.status === 'new');
            
            if (contactMessages.length === 0) {
                messagesList.innerHTML = '<p class="text-center text-slate-400">لا توجد رسائل جديدة</p>';
                return;
            }
            
            messagesList.innerHTML = contactMessages.map(msg => `
                <div class="admin-card">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold">${msg.subject}</h4>
                        <span class="text-slate-400 text-sm">${msg.timestamp}</span>
                    </div>
                    
                    <div class="space-y-2 text-sm mb-4">
                        <div><span class="text-slate-400">الاسم:</span> ${msg.name}</div>
                        <div><span class="text-slate-400">الهاتف:</span> ${msg.phone}</div>
                        <div><span class="text-slate-400">الرسالة:</span> ${msg.content}</div>
                    </div>
                    
                    ${msg.replies && msg.replies.length > 0 ? `
                        <div class="reply-section">
                            <h5 class="font-semibold mb-2">الردود:</h5>
                            ${msg.replies.map(reply => `
                                <div class="mb-2">
                                    <div class="font-semibold">${reply.admin}</div>
                                    <div>${reply.content}</div>
                                    <div class="text-slate-400 text-sm">${reply.timestamp}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="mt-4">
                        <textarea id="reply-${msg.id}" class="form-input w-full mb-2" placeholder="اكتب ردًا..."></textarea>
                        <div class="flex space-x-2 rtl:space-x-reverse">
                            <button onclick="sendReply('${msg.id}')" class="btn-primary flex-1 py-2">إرسال الرد</button>
                            <button onclick="completeMessage('${msg.id}')" class="bg-green-600 hover:bg-green-700 flex-1 py-2">تم الرد</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function loadCompletedMessagesTab() {
            const messagesList = document.getElementById('completedMessagesList');
            const contactMessages = adminMessages.filter(msg => msg.type === 'contact' && msg.status === 'completed');
            
            if (contactMessages.length === 0) {
                messagesList.innerHTML = '<p class="text-center text-slate-400">لا توجد رسائل مكتملة</p>';
                return;
            }
            
            messagesList.innerHTML = contactMessages.map(msg => `
                <div class="admin-card message-replied">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold">${msg.subject}</h4>
                        <span class="text-slate-400 text-sm">${msg.timestamp}</span>
                    </div>
                    
                    <div class="space-y-2 text-sm mb-4">
                        <div><span class="text-slate-400">الاسم:</span> ${msg.name}</div>
                        <div><span class="text-slate-400">الهاتف:</span> ${msg.phone}</div>
                        <div><span class="text-slate-400">الرسالة:</span> ${msg.content}</div>
                    </div>
                    
                    ${msg.replies && msg.replies.length > 0 ? `
                        <div class="reply-section">
                            <h5 class="font-semibold mb-2">الردود:</h5>
                            ${msg.replies.map(reply => `
                                <div class="mb-2">
                                    <div class="font-semibold">${reply.admin}</div>
                                    <div>${reply.content}</div>
                                    <div class="text-slate-400 text-sm">${reply.timestamp}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="mt-4 flex justify-between items-center">
                        <span class="text-green-400"><i class="fas fa-check-circle mr-1"></i> تم الرد</span>
                        <button onclick="reopenMessage('${msg.id}')" class="text-blue-400 hover:text-blue-300 text-sm">
                            إعادة فتح
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadCustomersTab() {
            const tableBody = document.getElementById('customersTableBody');
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            
            if (Object.keys(allUsersData).length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-slate-400 p-8">لا توجد بيانات عملاء</td></tr>';
                return;
            }
            
            tableBody.innerHTML = Object.entries(allUsersData).map(([phone, userData]) => {
                const userOrdersCount = adminOrders.filter(order => order.user === phone).length;
                
                return `
                    <tr class="hover:bg-slate-600/30">
                        <td class="p-4 relative">
                            ${userData.name}
                            ${userData.lastEdit ? `<span class="edit-indicator">معدل</span>` : ''}
                        </td>
                        <td class="p-4">${phone}</td>
                        <td class="p-4 text-green-400">${userData.balance?.toFixed(2) || '0.00'} جنيه</td>
                        <td class="p-4">${userOrdersCount}</td>
                        <td class="p-4 text-sm text-slate-400">${userData.registrationDate || 'غير محدد'}</td>
                        <td class="p-4 flex flex-wrap gap-2">
                            <button onclick="addBalance('${phone}')" class="admin-action-btn add-balance-btn">إضافة رصيد</button>
                            <button onclick="withdrawBalance('${phone}')" class="admin-action-btn withdraw-btn">سحب رصيد</button>
                            <button onclick="trackCustomer('${phone}')" class="admin-action-btn tracking-btn">تتبع</button>
                            <button onclick="deleteCustomer('${phone}')" class="admin-action-btn delete-btn">حذف</button>
                            <button onclick="toggleAdminStatus('${phone}')" class="admin-action-btn admin-btn">
                                ${userData.isAdmin ? 'إلغاء مسؤول' : 'تعيين مسؤول'}
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function startChat(phone) {
            showAdminTab('contactMessages');
            showNotification(`تم فتح محادثة مع العميل: ${phone}`, 'info');
        }
        
        function trackCustomer(phone) {
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            const user = allUsersData[phone];
            
            if (user) {
                const userInfo = `
                    الاسم: ${user.name}
                    رقم الهاتف: ${phone}
                    الرصيد: ${user.balance?.toFixed(2) || '0.00'} جنيه
                    تاريخ التسجيل: ${user.registrationDate || 'غير محدد'}
                    عدد الطلبات: ${adminOrders.filter(order => order.user === phone).length}
                `;
                
                alert(`معلومات التتبع:\n\n${userInfo}`);
            }
        }
        
        function loadProfitsTab() {
            // تحديث حقول التكلفة من البيانات المحفوظة
            document.getElementById('costViews10k').value = serviceCosts['views_10k'];
            document.getElementById('costLikes1k').value = serviceCosts['likes_1k'];
            document.getElementById('costSaves100').value = serviceCosts['saves_100'];
            document.getElementById('costShares100').value = serviceCosts['shares_100'];
            document.getElementById('costComment25').value = serviceCosts['comment_25'];
            document.getElementById('costFollowers1k').value = serviceCosts['followers_1k'];
            
            // حساب الأرباح تلقائيًا عند فتح التبويب
            calculateProfits();
            calculateMonthlyProfits();
        }
        
        function calculateProfits() {
            // تحديث تكاليف الخدمات من المدخلات
            serviceCosts['views_10k'] = parseFloat(document.getElementById('costViews10k').value) || 0;
            serviceCosts['likes_1k'] = parseFloat(document.getElementById('costLikes1k').value) || 0;
            serviceCosts['saves_100'] = parseFloat(document.getElementById('costSaves100').value) || 0;
            serviceCosts['shares_100'] = parseFloat(document.getElementById('costShares100').value) || 0;
            serviceCosts['comment_25'] = parseFloat(document.getElementById('costComment25').value) || 0;
            serviceCosts['followers_1k'] = parseFloat(document.getElementById('costFollowers1k').value) || 0;
            
            // حساب تكلفة الباقات تلقائياً
            serviceCosts['package_beginner'] = 
                (serviceCosts['views_10k'] * 0.75) + 
                (serviceCosts['likes_1k'] * 0.5) + 
                (serviceCosts['saves_100'] * 0.5) + 
                (serviceCosts['shares_100'] * 0.3);
                
            serviceCosts['package_basic'] = 
                (serviceCosts['views_10k'] * 1.35) + 
                (serviceCosts['likes_1k'] * 0.75) + 
                (serviceCosts['saves_100'] * 1) + 
                (serviceCosts['shares_100'] * 0.8);
                
            serviceCosts['package_intensive'] = 
                (serviceCosts['views_10k'] * 2.5) + 
                (serviceCosts['likes_1k'] * 1.25) + 
                (serviceCosts['saves_100'] * 2) + 
                (serviceCosts['shares_100'] * 1.3);
                
            serviceCosts['package_focused'] = 
                (serviceCosts['views_10k'] * 5) + 
                (serviceCosts['likes_1k'] * 2.5) + 
                (serviceCosts['saves_100'] * 3) + 
                (serviceCosts['shares_100'] * 2.5);
                
            serviceCosts['package_elite'] = 
                (serviceCosts['views_10k'] * 10) + 
                (serviceCosts['likes_1k'] * 5) + 
                (serviceCosts['saves_100'] * 5) + 
                (serviceCosts['shares_100'] * 4);
                
            serviceCosts['package_vip'] = 
                (serviceCosts['views_10k'] * 25) + 
                (serviceCosts['likes_1k'] * 10) + 
                (serviceCosts['saves_100'] * 10) + 
                (serviceCosts['shares_100'] * 7.5);
                
            serviceCosts['package_premium'] = 
                (serviceCosts['views_10k'] * 50) + 
                (serviceCosts['likes_1k'] * 20) + 
                (serviceCosts['saves_100'] * 20) + 
                (serviceCosts['shares_100'] * 15);
                
            serviceCosts['package_legend'] = 
                (serviceCosts['views_10k'] * 100) + 
                (serviceCosts['likes_1k'] * 50) + 
                (serviceCosts['saves_100'] * 50) + 
                (serviceCosts['shares_100'] * 30);
                
            serviceCosts['package_millionaire'] = 
                (serviceCosts['views_10k'] * 150) + 
                (serviceCosts['likes_1k'] * 75) + 
                (serviceCosts['saves_100'] * 100) + 
                (serviceCosts['shares_100'] * 50);
            
            // حفظ التكاليف
            saveUserData();
            
            // حساب الأرباح لكل خدمة (بدون رسوم فودافون كاش)
            const profitData = [
                { service: '10,000 مشاهدة', price: 5, cost: serviceCosts['views_10k'] },
                { service: '1,000 لايك', price: 10, cost: serviceCosts['likes_1k'] },
                { service: '100 حفظ', price: 2, cost: serviceCosts['saves_100'] },
                { service: '100 مشاركة', price: 1, cost: serviceCosts['shares_100'] },
                { service: '25 كومنت', price: 5, cost: serviceCosts['comment_25'] },
                { service: '1000 متابع', price: 100, cost: serviceCosts['followers_1k'] },
                { service: 'باقة المبتدئ', price: 5, cost: serviceCosts['package_beginner'] },
                { service: 'باقة الأساس', price: 7.5, cost: serviceCosts['package_basic'] },
                { service: 'باقة النشاط المكثف', price: 10, cost: serviceCosts['package_intensive'] },
                { service: 'باقة التفاعل المركز', price: 20, cost: serviceCosts['package_focused'] },
                { service: 'باقة النخبة', price: 35, cost: serviceCosts['package_elite'] },
                { service: 'باقة VIP', price: 60, cost: serviceCosts['package_vip'] },
                { service: 'باقة التميز', price: 100, cost: serviceCosts['package_premium'] },
                { service: 'باقة الأسطورة', price: 180, cost: serviceCosts['package_legend'] },
                { service: 'باقة المليونير', price: 300, cost: serviceCosts['package_millionaire'] }
            ];
            
            // تحديث الجدول
            const profitReportTable = document.getElementById('profitReportTable');
            profitReportTable.innerHTML = profitData.map(item => {
                const profit = item.price - item.cost;
                const profitPercentage = (profit / item.price) * 100;
                const monthNames = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];
                const currentMonth = new Date().getMonth();
                
                return `
                    <tr>
                        <td class="p-4">${item.service}</td>
                        <td class="p-4">${item.price.toFixed(2)} جنيه</td>
                        <td class="p-4">${item.cost.toFixed(2)} جنيه</td>
                        <td class="p-4 ${profit >= 0 ? 'text-green-400' : 'text-red-400'}">
                            ${profit.toFixed(2)} جنيه
                        </td>
                        <td class="p-4">${profitPercentage.toFixed(1)}%</td>
                        <td class="p-4">${monthNames[currentMonth]}</td>
                    </tr>
                `;
            }).join('');
            
            showNotification('تم تحديث تقرير الأرباح بنجاح', 'success');
        }
        
        function addBalance(phone) {
            const amount = prompt('أدخل المبلغ لإضافته:');
            if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                showNotification('المبلغ غير صحيح', 'error');
                return;
            }
            
            const parsedAmount = parseFloat(amount);
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            const user = allUsersData[phone];
            
            if (!user) {
                showNotification('العميل غير موجود', 'error');
                return;
            }
            
            const reason = prompt('السبب:');
            if (!reason) return;
            
            user.balance = parseFloat((user.balance + parsedAmount).toFixed(2));
            
            // تحديث إجمالي شحن الرصيد
            totalBalanceCharged = parseFloat((totalBalanceCharged + parsedAmount).toFixed(2));
            
            // إضافة تاريخ المعاملة
            if (!user.balanceHistory) user.balanceHistory = [];
            user.balanceHistory.push({
                amount: parsedAmount,
                type: 'deposit',
                date: new Date().toLocaleString('ar-EG'),
                note: reason
            });
            
            localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
            
            // تحديث واجهة المستخدم إذا كان هو الحالي
            if (currentUser && currentUser.phone === phone) {
                currentUser.balance = user.balance;
                updateBalanceDisplay();
            }
            
            // تحديث إحصائيات لوحة التحكم
            loadAdminStats();
            
            showNotification(`تم إضافة ${parsedAmount} جنيه إلى رصيد العميل`, 'success');
            loadCustomersTab();
        }

        function approveOrder(orderId) {
            const order = adminOrders.find(o => o.id === orderId);
            if (order) {
                order.status = 'processing';
                
                const userOrder = userOrders.find(o => o.id === orderId);
                if (userOrder) {
                    userOrder.status = 'processing';
                }
                
                // تحديث حالة الطلب في Firestore
                await updateOrderStatusInFirestore(orderId, 'cancelled');
                saveUserData();
                loadNewOrdersTab();
                loadActiveOrdersTab();
                showNotification('تم قبول الطلب وبدء التنفيذ', 'success');
            }
        }

        function rejectOrder(orderId) {
            const orderIndex = adminOrders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;

            const order = adminOrders[orderIndex];
            
            // Restore balance to user
            const allUsers = JSON.parse(localStorage.getItem('allUsersData')) || {};
            const orderUser = allUsers[order.user];

            if (orderUser) {
                orderUser.balance = parseFloat((orderUser.balance + order.totalPrice).toFixed(2));
                localStorage.setItem('allUsersData', JSON.stringify(allUsers));
                
                // If the rejected order user is the current user, update the interface
                if (currentUser && currentUser.phone === order.user) {
                    currentUser.balance = orderUser.balance;
                    updateBalanceDisplay();
                }
            }

            order.status = 'cancelled';
            
            const userOrder = userOrders.find(o => o.id === orderId);
            if (userOrder) {
                userOrder.status = 'cancelled';
            }
            
            saveUserData();
            loadNewOrdersTab();
            showNotification(`تم رفض الطلب #${orderId} وإعادة مبلغ ${order.totalPrice} جنيه لرصيد المستخدم.`, 'info');
        }

        async function completeOrder(orderId) {
            const order = adminOrders.find(o => o.id === orderId);
            if (order) {
                order.status = 'completed';
                
                const userOrder = userOrders.find(o => o.id === orderId);
                if (userOrder) {
                    userOrder.status = 'completed';
                }
                // تحديث الحالة في Firestore
                await updateOrderStatusInFirestore(orderId, 'completed');
                
                // تسجيل الربح في التاريخ
                addToProfitHistory(order);
                
                saveUserData();
                loadActiveOrdersTab();
                loadCompletedOrdersTab();
                showNotification('تم إكمال الطلب بنجاح', 'success');
            }
        }
        
        async function cancelOrder(orderId) {
            const order = adminOrders.find(o => o.id === orderId);
            if (order) {
                order.status = 'cancelled';
                
                const userOrder = userOrders.find(o => o.id === orderId);
                if (userOrder) {
                    userOrder.status = 'cancelled';
                }
                
                // Restore balance to user
                const allUsers = JSON.parse(localStorage.getItem('allUsersData')) || {};
                const orderUser = allUsers[order.user];
                if (orderUser) {
                    orderUser.balance = parseFloat((orderUser.balance + order.totalPrice).toFixed(2));
                    localStorage.setItem('allUsersData', JSON.stringify(allUsers));
                    
                    // If the canceled order user is the current user, update the interface
                    if (currentUser && currentUser.phone === order.user) {
                        currentUser.balance = orderUser.balance;
                        updateBalanceDisplay();
                    }
                }
                
                saveUserData();
                loadActiveOrdersTab();
                loadUserOrdersPage();
                showNotification('تم إلغاء الطلب بنجاح', 'success');
            }
        }

        function approveBalanceRequest(requestId) {
            const requestIndex = balanceRequests.findIndex(r => r.id === requestId);
            if (requestIndex === -1) return;
            
            const request = balanceRequests[requestIndex];
            const amount = parseFloat(request.amount);
            
            // تحديث رصيد المستخدم
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            const user = allUsersData[request.user];
            
            if (user) {
                user.balance = parseFloat((user.balance + amount).toFixed(2));
                localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
                
                // تحديث واجهة المستخدم إذا كان هو الحالي
                if (currentUser && currentUser.phone === request.user) {
                    currentUser.balance = user.balance;
                    updateBalanceDisplay();
                }
                
                // تحديث إجمالي شحن الرصيد
                totalBalanceCharged = parseFloat((totalBalanceCharged + amount).toFixed(2));
                
                // إضافة تاريخ المعاملة
                if (!user.balanceHistory) user.balanceHistory = [];
                user.balanceHistory.push({
                    amount: amount,
                    type: 'deposit',
                    date: new Date().toLocaleString('ar-EG'),
                    note: `شحن رصيد بمعاملة ${request.transactionId}`
                });
            }
            
            // تغيير حالة الطلب إلى مكتمل
            request.status = 'completed';
            
            saveUserData();
            loadBalanceRequestsTab();
            loadCompletedBalanceRequestsTab();
            showNotification(`تمت الموافقة على طلب الشحن وإضافة ${amount} جنيه إلى رصيد المستخدم.`, 'success');
        }

        function rejectBalanceRequest(requestId) {
            const requestIndex = balanceRequests.findIndex(r => r.id === requestId);
            if (requestIndex === -1) return;
            
            const request = balanceRequests[requestIndex];
            // تغيير حالة الطلب إلى ملغي
            request.status = 'cancelled';
            saveUserData();
            loadBalanceRequestsTab();
            loadCompletedBalanceRequestsTab();
            showNotification('تم رفض طلب الشحن', 'info');
        }

        function deleteCustomer(phone) {
            if (!confirm('هل أنت متأكد من حذف هذا العميل؟ سيتم حذف جميع بياناته.')) return;
            
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            delete allUsersData[phone];
            localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
            
            // إزالة طلبات العميل
            userOrders = userOrders.filter(order => order.user !== phone);
            adminOrders = adminOrders.filter(order => order.user !== phone);
            
            saveUserData();
            loadCustomersTab();
            showNotification('تم حذف العميل بنجاح', 'success');
        }

        function toggleAdminStatus(phone) {
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            const user = allUsersData[phone];
            
            if (user) {
                user.isAdmin = !user.isAdmin;
                localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
                
                showNotification(`تم ${user.isAdmin ? 'تعيين' : 'إلغاء'} صلاحية المسؤول للعميل`, 'success');
                loadCustomersTab();
            }
        }

        function withdrawBalance(phone) {
            const amount = prompt('أدخل المبلغ لسحبه:');
            if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                showNotification('المبلغ غير صحيح', 'error');
                return;
            }
            
            const parsedAmount = parseFloat(amount);
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            const user = allUsersData[phone];
            
            if (!user) {
                showNotification('العميل غير موجود', 'error');
                return;
            }
            
            if (parsedAmount > user.balance) {
                showNotification('الرصيد غير كافي', 'error');
                return;
            }
            
            const reason = prompt('السبب:');
            if (!reason) return;
            
            user.balance = parseFloat((user.balance - parsedAmount).toFixed(2));
            
            // تحديث إجمالي شحن الرصيد
            totalBalanceCharged = parseFloat((totalBalanceCharged - parsedAmount).toFixed(2));
            
            // إضافة تاريخ المعاملة
            if (!user.balanceHistory) user.balanceHistory = [];
            user.balanceHistory.push({
                amount: parsedAmount,
                type: 'withdraw',
                date: new Date().toLocaleString('ar-EG'),
                note: reason
            });
            
            localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
            
            // تحديث واجهة المستخدم إذا كان هو الحالي
            if (currentUser && currentUser.phone === phone) {
                currentUser.balance = user.balance;
                updateBalanceDisplay();
            }
            
            // تحديث إحصائيات لوحة التحكم
            loadAdminStats();
            
            showNotification(`تم سحب ${parsedAmount} جنيه من رصيد العميل`, 'success');
            loadCustomersTab();
        }

        async function sendReply(messageId) {
            const replyContent = document.getElementById(`reply-${messageId}`).value;
            if (!replyContent) return;
            
            const messageIndex = adminMessages.findIndex(msg => msg.id == messageId);
            if (messageIndex === -1) return;
            
            const message = adminMessages[messageIndex];
            if (!message.replies) message.replies = [];
            
            message.replies.push({
                admin: 'الدعم الفني',
                content: replyContent,
                timestamp: new Date().toLocaleString('ar-EG')
            });
            
            saveUserData();
            loadContactMessagesTab();
            // تحديث الرسالة في Firestore
            await updateMessageInFirestore(messageId, { replies: message.replies });
            showNotification('تم إرسال الرد بنجاح', 'success');
        }

        async function completeMessage(messageId) {
            const messageIndex = adminMessages.findIndex(msg => msg.id == messageId);
            if (messageIndex === -1) return;
            
            adminMessages[messageIndex].status = 'completed';
            saveUserData();
            // تحديث في Firestore
            await updateMessageInFirestore(messageId, { status: 'completed' });
            loadContactMessagesTab();
            loadCompletedMessagesTab();
            showNotification('تم تمييز الرسالة كمكتملة', 'success');
        }

        async function reopenMessage(messageId) {
            const messageIndex = adminMessages.findIndex(msg => msg.id == messageId);
            if (messageIndex === -1) return;
            
            adminMessages[messageIndex].status = 'new';
            saveUserData();
            // تحديث في Firestore
            await updateMessageInFirestore(messageId, { status: 'new' });
            loadCompletedMessagesTab();
            loadContactMessagesTab();
            showNotification('تم إعادة فتح الرسالة', 'info');
        }

        function showProfile() {
            if (!currentUser) return;
            
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            const userData = allUsersData[currentUser.phone];
            
            document.getElementById('profilePage').innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-8">الملف الشخصي</h2>
                    
                    <div class="profile-form">
                        <form id="profileForm" class="space-y-4" onsubmit="updateProfile(event)">
                            <div>
                                <label class="block text-sm font-medium mb-2">الاسم الكامل</label>
                                <input type="text" id="profileName" class="auth-input" value="${userData.name}" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">رقم الهاتف</label>
                                <input type="tel" id="profilePhone" class="auth-input" value="${currentUser.phone}" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">كلمة المرور الحالية (للتأكيد)</label>
                                <input type="password" id="currentPassword" class="auth-input" placeholder="أدخل كلمة المرور الحالية" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">كلمة المرور الجديدة (اختياري)</label>
                                <input type="password" id="newPassword" class="auth-input" placeholder="أدخل كلمة مرور جديدة">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">تأكيد كلمة المرور الجديدة</label>
                                <input type="password" id="confirmNewPassword" class="auth-input" placeholder="أعد إدخال كلمة المرور الجديدة">
                            </div>
                            
                            <button type="submit" class="auth-btn">حفظ التغييرات</button>
                        </form>
                        
                        <div class="mt-6">
                            <button onclick="deleteAccount()" class="bg-red-600 hover:bg-red-700 text-white w-full py-3 rounded-lg transition-colors">
                                حذف الحساب
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            showPage('profile');
        }

        function updateProfile(e) {
            e.preventDefault();
            
            if (!currentUser) return;
            
            const name = document.getElementById('profileName').value;
            const phone = document.getElementById('profilePhone').value;
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            // التحقق من كلمة المرور الحالية
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            const userData = allUsersData[currentUser.phone];
            
            if (!userData || userData.password !== currentPassword) {
                showNotification('كلمة المرور الحالية غير صحيحة', 'error');
                return;
            }
            
            // التحقق من تطابق كلمات المرور الجديدة
            if (newPassword && newPassword !== confirmPassword) {
                showNotification('كلمات المرور الجديدة غير متطابقة', 'error');
                return;
            }
            
            // تحديث بيانات المستخدم
            userData.name = name;
            
            // تحديث كلمة المرور إذا تم إدخال واحدة جديدة
            if (newPassword) {
                userData.password = newPassword;
            }
            
            // تسجيل تاريخ التعديل
            userData.lastEdit = new Date().toLocaleString('ar-EG');
            userEdits.push({
                userId: currentUser.phone,
                timestamp: userData.lastEdit
            });
            
            // إذا تم تغيير رقم الهاتف
            if (phone !== currentUser.phone) {
                // التحقق من عدم وجود الرقم الجديد
                if (allUsersData[phone]) {
                    showNotification('رقم الهاتف مستخدم بالفعل', 'error');
                    return;
                }
                
                // نقل البيانات إلى الرقم الجديد
                allUsersData[phone] = userData;
                delete allUsersData[currentUser.phone];
                
                // تحديث الطلبات والرسائل
                userOrders.forEach(order => {
                    if (order.user === currentUser.phone) {
                        order.user = phone;
                    }
                });
                adminOrders.forEach(order => {
                    if (order.user === currentUser.phone) {
                        order.user = phone;
                    }
                });
                adminMessages.forEach(msg => {
                    if (msg.user === currentUser.phone) {
                        msg.user = phone;
                    }
                });
                
                // تحديث المستخدم الحالي
                currentUser.phone = phone;
            }
            
            // تحديث بيانات المستخدم الحالي
            currentUser.name = name;
            
            // حفظ التغييرات
            localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
            saveUserData();
            
            // تحديث واجهة المستخدم
            document.getElementById('userName').textContent = name;
            document.getElementById('userInitial').textContent = name.charAt(0);
            
            showNotification('تم تحديث الملف الشخصي بنجاح', 'success');
            showPage('home');
        }

        function verifyTwoFactor() {
            const code = document.getElementById('twoFactorCode').value;
            if (code && code.length === 6) {
                showNotification('تم تفعيل المصادقة الثنائية بنجاح', 'success');
                hideTwoFactorModal();
            } else {
                showNotification('الرجاء إدخال رمز تحقق صحيح', 'error');
            }
        }

        function deleteAccount() {
            if (!confirm('هل أنت متأكد من حذف حسابك؟ سيتم حذف جميع بياناتك بشكل دائم.')) return;
            
            if (!currentUser) return;
            
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            delete allUsersData[currentUser.phone];
            localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
            
            // Remove user orders
            userOrders = userOrders.filter(order => order.user !== currentUser.phone);
            adminOrders = adminOrders.filter(order => order.user !== currentUser.phone);
            adminMessages = adminMessages.filter(msg => msg.user !== currentUser.phone);
            
            // Logout
            logout();
            showNotification('تم حذف حسابك بنجاح', 'success');
        }

        // دوال مسح جميع البيانات
        function showClearAllDataModal() {
            document.getElementById('clearAllDataModal').classList.remove('hidden');
        }
        
        function hideClearAllDataModal() {
            document.getElementById('clearAllDataModal').classList.add('hidden');
        }
        
        function handleClearAllData(e) {
            e.preventDefault();
            const password = document.getElementById('clearDataPassword').value;
            
            if (password === 'kimo777kimo' || password === 'taf3el2024') {
                clearAllData();
                hideClearAllDataModal();
            } else {
                showNotification('كلمة المرور غير صحيحة', 'error');
            }
        }
        
        function clearAllData() {
            // حفظ بيانات العملاء فقط
            const allUsersData = JSON.parse(localStorage.getItem('allUsersData')) || {};
            
            // مسح كل البيانات الأخرى
            localStorage.clear();
            
            // إعادة حفظ بيانات العملاء فقط
            localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
            
            // إعادة تحميل الصفحة
            alert('تم مسح جميع البيانات بنجاح باستثناء بيانات العملاء. سيتم إعادة تحميل الصفحة.');
            location.reload();
        }

        // Utility functions
        function logout() {
            currentUser = null;
            isAdmin = false;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('isAdmin');
            hideUserProfile();
            hideAdminAccess();
            showPage('home');
            showNotification('تم تسجيل الخروج بنجاح', 'success');
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const bgColor = {
                'success': 'bg-green-600',
                'error': 'bg-red-600',
                'warning': 'bg-yellow-600',
                'info': 'bg-blue-600'
            }[type] || 'bg-blue-600';
            
            notification.className = `notification ${bgColor} text-white p-4 rounded-lg shadow-lg max-w-sm`;
            notification.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200 ml-2">
                        ×
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#userAvatar')) {
                document.getElementById('userDropdown').classList.add('hidden');
            }
        });
    </script>
</body>
</html>
